import e from"./Layout-808b9c88.js";import{d as l}from"./vue-toast-notification-f2a3de7a.js";import{am as t,o as s,c as a,a as o,k as n,q as i,M as u,N as d,K as c,p as r,C as m}from"./@vue-9ee83fb6.js";import"./@vueuse-3c3b27e0.js";import"./unidecode-5a54da0f.js";import"./@ckeditor-fa9b3055.js";import"./vue-abe8eda6.js";const h={class:"mainAppWrapper d-flex flex-column"},b={class:"mainBarWrapper px-5 pt-3 flex-grow-0 flex-shrink-0"},p={class:"d-flex justify-space-between"},f={class:"--left d-flex"},v={class:"--left d-flex me-4"},g={class:"--listing"},j={class:"d-flex flex-1-0 flex-column w-0"},A=o("span",null,"Users",-1),V={class:"--objectTitle"},k={class:"--right"},C=o("span",{class:"--text"},"Basic",-1),D=o("span",{class:"--text"},"Permissions",-1),y={class:"mainContentWrapper detailContentWrapper d-flex flex-grow-1 flex-shrink-1 overflow-hidden"},_={class:"detailFormWrapper pa-5 flex-grow-1 overflow-auto"},w={class:"componentLayout-tabPanel"},x={class:"--formContent componentField-select"},S=o("label",null," Role ",-1),O={class:"--listing"},R=o("thead",null,[o("tr",null,[o("th",null," Documents "),o("th",null,"All"),o("th",null,"List"),o("th",null,"View"),o("th",null,"Save"),o("th",null,"Publish"),o("th",null," Unpublish "),o("th",null,"Delete"),o("th",null,"Create")])],-1),U=o("td",null,"All",-1),P=o("thead",null,[o("tr",null,[o("th",null,"Object"),o("th",null,"All"),o("th",null,"List"),o("th",null,"View"),o("th",null,"Save"),o("th",null,"Publish"),o("th",null," Unpublish "),o("th",null,"Delete"),o("th",null,"Create")])],-1),I=o("thead",null,[o("tr",null,[o("th",null,"Assets"),o("th",null,"All"),o("th",null,"List"),o("th",null,"View"),o("th",null,"Save"),o("th",null,"Publish"),o("th",null," Unpublish "),o("th",null,"Delete"),o("th",null,"Create")])],-1),T=o("td",null,"Assets",-1),L={data(){var e=[],t=[];return this.objectSetting.forEach((l=>{var s=this.user.splitArrPermission?this.user.splitArrPermission.object.filter((e=>e.includes(l.name+"Object"))):[];l.name,e=[l.name+"ObjectList",l.name+"ObjectView",l.name+"ObjectSave",l.name+"ObjectPublish",l.name+"ObjectUnPublish",l.name+"ObjectDelete",l.name+"ObjectCreate"],l.name,t.push({objArr:e,vmodelObjSelected:!1,vmodelObjArr:s,objName:l.name})})),console.log(this.objectSetting.objArr),{toast:l.useToast({position:"top-right",style:{zIndex:"200"}}),tab:null,tabPermission:null,column:null,inline:null,username:[e=>!!e||"Required.",e=>(e||"").length<=20||"Max 20 characters"],email:[e=>!!e||"Required.",e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"Invalid e-mail."],name:[e=>!!e||"Required."],password:[e=>!!e||"Required.",e=>(e||"").length>=6||"Password must be at least 6 characters"],role:[e=>!!e||"Required."],documentRoles:["homeDocumentList","homeDocumentView","homeDocumentSave","homeDocumentPublish","homeDocumentUnPublish","homeDocumentDelete","homeDocumentCreate"],docRoleSelected:this.user.splitArrPermission.document,objectRoleSelected:[],assetsRoleSelected:this.user.splitArrPermission.assets,assetsRoles:["assetsList","assetsView","assetsSave","assetsPublish","assetsUnPublish","assetsDelete","assetsCreate"],selectAllDocument:!1,selectAllAssets:!1,objectOptions:t,toast:l.useToast(),showDeleteDialog:!1}},mounted(){this.checkIfAllAssetsChecked(),this.checkIfAllDocumentChecked(),this.objectSetting.forEach((e=>{this.checkIfAllObjectChecked(e)}))},methods:{showDeleteConfirmationDialog(e){this.itemToDelete=e,this.showDeleteDialog=!0},deleteItem(){const e=new FormData;e.append("id",this.itemToDelete),this.$inertia.post(route("user_delete"),e),this.showDeleteDialog=!1},closeDeleteDialog(){this.showDeleteDialog=!1,this.itemToDelete=null},save(e){this.objectOptions.forEach((e=>{this.objectRoleSelected=this.objectRoleSelected.concat(e.vmodelObjArr)})),this.user.permission=[...this.docRoleSelected,...this.objectRoleSelected,...this.assetsRoleSelected];const l=new FormData;Object.entries(this.user).forEach((([e,t])=>{null!=t&&l.append(e,t)})),fetch(route("user_detail",{id:this.user.id}),{method:"POST",body:l}).then((e=>{if(e.ok)return e.json();throw new Error("Lỗi xảy ra khi gửi yêu cầu.")})).then((e=>{e.warning?this.warningMess(e.warning):(this.successMess("Update user success!"),this.$inertia.get(route("user_detail",{id:this.user.id})))})).catch((e=>{console.error("Lỗi xảy ra khi gửi yêu cầu:",e)})).finally((()=>{this.loading=!1}))},toggleAllCheckboxesDocument(){this.docRoleSelected=this.selectAllDocument?this.documentRoles.slice():[]},checkIfAllDocumentChecked(){this.selectAllDocument=this.docRoleSelected.length==this.documentRoles.length},toggleAllCheckboxesAssets(){this.assetsRoleSelected=this.selectAllAssets?this.assetsRoles.slice():[]},checkIfAllAssetsChecked(){this.selectAllAssets=this.assetsRoleSelected.length==this.assetsRoles.length},checkIfAllObjectChecked(e,l){this.objectOptions.forEach((l=>{console.log(l),e==l.objName&&(l.vmodelObjSelected=l.vmodelObjArr.length==l.objArr.length)}))},toggleAllCheckboxesObject(e){this.objectOptions.forEach((l=>{e==l.objName&&(l.vmodelObjArr=l.vmodelObjSelected?l.objArr.slice():[])}))},backToListing(){this.$inertia.visit(route("user_listing"))},warningMess(e){e&&setTimeout((()=>{this.toast.open({message:e,type:"warning"})}),1e3)},successMess(e){e&&setTimeout((()=>{this.toast.open({message:e,type:"success"})}),1e3)}}},q=Object.assign(L,{layout:e},{__name:"Detail",props:{user:{permission:{}},roles:Array,flash:Object,objectSetting:Array},setup:e=>(l,L)=>{const q=t("v-icon"),F=t("v-breadcrumbs-item"),E=t("v-breadcrumbs"),M=t("v-btn"),N=t("v-toolbar-title"),W=t("v-toolbar"),z=t("v-card-text"),$=t("v-card-actions"),B=t("v-card"),Z=t("v-dialog"),G=t("v-tab"),K=t("v-tabs"),H=t("v-switch"),J=t("v-col"),Q=t("Input"),X=t("Select"),Y=t("v-row"),ee=t("v-window-item"),le=t("v-radio"),te=t("v-radio-group"),se=t("v-checkbox"),ae=t("Checkbox"),oe=t("v-table"),ne=t("v-window");return s(),a("div",h,[o("div",b,[o("div",p,[o("div",f,[o("div",v,[o("div",{class:"--objectIcon me-3",disabled:!1,onClick:L[0]||(L[0]=(...e)=>l.backToListing&&l.backToListing(...e))},[o("div",g,[n(q,{icon:"mdi-account-outline"}),n(q,{icon:"mdi-arrow-left"}),n(q,{icon:"mdi-account-outline"})])]),o("div",j,[n(E,{class:"breadcrumbWrapper pa-0"},{default:i((()=>[n(F,{class:"--itemBreadcrumb",disabled:!1,onClick:l.backToListing,title:"Users"},{default:i((()=>[A])),_:1},8,["onClick"])])),_:1}),o("h3",V,u(e.user.name),1)])])]),o("div",k,[n(M,{class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-check",onClick:L[1]||(L[1]=e=>l.save())},{default:i((()=>[d(" Save ")])),_:1}),n(M,{variant:"elevated",class:"bg-red","prepend-icon":"mdi-delete-outline",onClick:L[2]||(L[2]=t=>l.showDeleteConfirmationDialog(e.user.id))},{default:i((()=>[d(" Delete ")])),_:1}),n(Z,{modelValue:l.showDeleteDialog,"onUpdate:modelValue":L[3]||(L[3]=e=>l.showDeleteDialog=e),"max-width":"300"},{default:i((()=>[n(B,null,{default:i((()=>[n(W,{color:"red-lighten-5",density:"compact"},{default:i((()=>[n(N,{text:"Delete",class:"text-red-darken-1"})])),_:1}),n(z,{class:"py-8"},{default:i((()=>[d(" Are you sure you want to delete? ")])),_:1}),n($,{class:"justify-end"},{default:i((()=>[n(M,{color:"",variant:"text",onClick:l.closeDeleteDialog},{default:i((()=>[d("Close ")])),_:1},8,["onClick"]),n(M,{variant:"elevated",color:"red-darken-1",onClick:l.deleteItem},{default:i((()=>[d(" Delete ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])]),n(K,{modelValue:l.tab,"onUpdate:modelValue":L[4]||(L[4]=e=>l.tab=e),class:"mainTabPanel"},{default:i((()=>[n(G,{value:"information"},{default:i((()=>[C])),_:1}),n(G,{value:"permission"},{default:i((()=>[D])),_:1})])),_:1},8,["modelValue"])]),o("div",y,[o("div",_,[o("div",w,[o("form",{onSubmit:L[22]||(L[22]=(...e)=>l.submitForm&&l.submitForm(...e))},[n(ne,{modelValue:l.tab,"onUpdate:modelValue":L[21]||(L[21]=e=>l.tab=e)},{default:i((()=>[n(ee,{value:"information"},{default:i((()=>[n(Y,null,{default:i((()=>[n(J,{cols:"12"},{default:i((()=>[n(H,{label:"Active",color:"theme","false-value":0,"true-value":1,"hide-details":"",inset:"",modelValue:e.user.active,"onUpdate:modelValue":L[5]||(L[5]=l=>e.user.active=l),class:"--fieldRequired"},null,8,["modelValue"])])),_:1}),n(J,{cols:"6"},{default:i((()=>[n(Q,{name:"username",label:"Username",modelValue:e.user.username,"onUpdate:modelValue":L[6]||(L[6]=l=>e.user.username=l),class:"--fieldRequired"},null,8,["modelValue"]),n(Q,{name:"email",label:"Email",modelValue:e.user.email,"onUpdate:modelValue":L[7]||(L[7]=l=>e.user.email=l),class:"--fieldRequired"},null,8,["modelValue"]),n(Q,{name:"name",label:"Fullname",modelValue:e.user.name,"onUpdate:modelValue":L[8]||(L[8]=l=>e.user.name=l),class:"--fieldRequired"},null,8,["modelValue"]),o("div",x,[S,n(X,{name:"roles",items:e.roles,itemTitle:"name",itemValue:"id",modelValue:e.user.role,"onUpdate:modelValue":L[9]||(L[9]=l=>e.user.role=l),class:"--fieldRequired"},null,8,["items","modelValue"])])])),_:1})])),_:1})])),_:1}),n(ee,{value:"permission",class:"userPermissionWrapper"},{default:i((()=>[n(Y,null,{default:i((()=>[n(J,{cols:"12"},{default:i((()=>[n(te,{class:"--formContent componentField-radioGroup",modelValue:e.user.accessibleData,"onUpdate:modelValue":L[10]||(L[10]=l=>e.user.accessibleData=l),inline:"","hide-details":"",label:"Accessible"},{default:i((()=>[n(le,{label:"All",value:"all"}),n(le,{label:"My Data only",value:"personalDataOnly"})])),_:1},8,["modelValue"])])),_:1}),n(J,{cols:"12"},{default:i((()=>[o("div",O,[n(K,{modelValue:l.tabPermission,"onUpdate:modelValue":L[11]||(L[11]=e=>l.tabPermission=e),direction:"horizontal"},{default:i((()=>[n(G,{value:"documents"},{default:i((()=>[n(q,{start:""},{default:i((()=>[d(" mdi-file-document-outline ")])),_:1}),d(" Documents ")])),_:1}),n(G,{value:"object"},{default:i((()=>[n(q,{start:""},{default:i((()=>[d(" mdi-cube-outline ")])),_:1}),d(" Object ")])),_:1}),n(G,{value:"assets"},{default:i((()=>[n(q,{start:""},{default:i((()=>[d(" mdi-image-outline ")])),_:1}),d(" Assets ")])),_:1})])),_:1},8,["modelValue"]),n(ne,{modelValue:l.tabPermission,"onUpdate:modelValue":L[20]||(L[20]=e=>l.tabPermission=e)},{default:i((()=>[n(ee,{value:"documents",class:"pa-0"},{default:i((()=>[n(oe,{"fixed-header":""},{default:i((()=>[R,o("tbody",null,[o("tr",null,[U,o("td",null,[n(se,{modelValue:l.selectAllDocument,"onUpdate:modelValue":L[12]||(L[12]=e=>l.selectAllDocument=e),onChange:L[13]||(L[13]=e=>l.toggleAllCheckboxesDocument()),type:"multi","hide-details":"",class:"--formContent componentField-checkbox"},null,8,["modelValue"])]),(s(!0),a(c,null,r(l.documentRoles,(t=>(s(),a("td",null,[e.user.rolePermission.includes(t)?(s(),m(ae,{key:0,modelValue:l.docRoleSelected,"onUpdate:modelValue":L[14]||(L[14]=e=>l.docRoleSelected=e),label:"",value:t,type:"multi",color:"grey",onChange:l.checkIfAllDocumentChecked},null,8,["modelValue","value","onChange"])):(s(),m(ae,{key:1,modelValue:l.docRoleSelected,"onUpdate:modelValue":L[15]||(L[15]=e=>l.docRoleSelected=e),value:t,label:"",type:"multi",onChange:l.checkIfAllDocumentChecked},null,8,["modelValue","value","onChange"]))])))),256))])])])),_:1})])),_:1}),n(ee,{value:"object",class:"pa-0"},{default:i((()=>[n(oe,{"fixed-header":""},{default:i((()=>[P,o("tbody",null,[(s(!0),a(c,null,r(l.objectOptions,((t,i)=>(s(),a("tr",null,[o("td",null,u(t.objName),1),o("td",null,[n(se,{modelValue:t.vmodelObjSelected,"onUpdate:modelValue":e=>t.vmodelObjSelected=e,onChange:e=>l.toggleAllCheckboxesObject(t.objName),type:"multi","hide-details":"",class:"--formContent componentField-checkbox"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),(s(!0),a(c,null,r(t.objArr,(o=>(s(),a("td",null,[e.user.rolePermission.includes(o)?(s(),m(ae,{key:0,modelValue:t.vmodelObjArr,"onUpdate:modelValue":e=>t.vmodelObjArr=e,label:"",value:o,type:"multi",color:"grey",onChange:e=>l.checkIfAllObjectChecked(t.objName,o)},null,8,["modelValue","onUpdate:modelValue","value","onChange"])):(s(),m(ae,{key:1,modelValue:t.vmodelObjArr,"onUpdate:modelValue":e=>t.vmodelObjArr=e,value:o,label:"",type:"multi",onChange:e=>l.checkIfAllObjectChecked(t.objName,o)},null,8,["modelValue","onUpdate:modelValue","value","onChange"]))])))),256))])))),256))])])),_:1})])),_:1}),n(ee,{value:"assets",class:"pa-0"},{default:i((()=>[n(oe,{"fixed-header":""},{default:i((()=>[I,o("tbody",null,[o("tr",null,[T,o("td",null,[n(se,{modelValue:l.selectAllAssets,"onUpdate:modelValue":L[16]||(L[16]=e=>l.selectAllAssets=e),onChange:L[17]||(L[17]=e=>l.toggleAllCheckboxesAssets()),type:"multi","hide-details":"",class:"--formContent componentField-checkbox"},null,8,["modelValue"])]),(s(!0),a(c,null,r(l.assetsRoles,(t=>(s(),a("td",null,[e.user.rolePermission.includes(t)?(s(),m(ae,{key:0,modelValue:l.assetsRoleSelected,"onUpdate:modelValue":L[18]||(L[18]=e=>l.assetsRoleSelected=e),label:"",value:t,type:"multi",color:"grey",onChange:l.checkIfAllAssetsChecked},null,8,["modelValue","value","onChange"])):(s(),m(ae,{key:1,modelValue:l.assetsRoleSelected,"onUpdate:modelValue":L[19]||(L[19]=e=>l.assetsRoleSelected=e),value:t,label:"",type:"multi",onChange:l.checkIfAllAssetsChecked},null,8,["modelValue","value","onChange"]))])))),256))])])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],32)])])])])}});export{q as default};
