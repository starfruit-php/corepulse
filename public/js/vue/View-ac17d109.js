import{am as t,o as e,c as a,a as i,k as r,q as s,N as l,I as o,C as c,E as n,K as h,p as d,G as p}from"./@vue-9ee83fb6.js";import m from"./Layout-b42d48af.js";import"./@vueuse-3c3b27e0.js";import"./unidecode-5a54da0f.js";import"./@ckeditor-fa9b3055.js";import"./vue-abe8eda6.js";const f={class:"mainAppWrapper d-flex flex-column"},u={class:"mainBarWrapper px-5 py-3 d-flex justify-space-between align-center flex-grow-0 flex-shrink-0"},v={class:"--left d-flex align-center"},g=i("div",{class:"d-flex flex-1-0 flex-column w-0"},[i("h3",{class:"--objectTitle"},"Report")],-1),x=i("div",{class:"--right"},null,-1),y={class:"mainContentWrapper detailContentWrapper d-flex flex-grow-1 flex-shrink-1 overflow-hidden"},w={class:"detailFormWrapper d-flex flex-grow-1 overflow-hidden"},b={class:"d-flex flex-column py-5 px-5 reportListingWrapper w-20"},k={class:"--formContent componentField-input"},C={class:"overflow-auto"},D={key:0,class:"w-80 px-5 pt-5 overflow-auto"},L={class:"reportTableWrapper py-4 d-flex flex-column overflow-visible"},S={class:"--filterBar d-flex align-center justify-end mb-2"},j={class:"tableListingWrapper d-flex flex-column"},O={key:1,class:"w-80 ps-5"},_=[i("div",{class:"px-4 py-4 mb-5"},null,-1)],N={name:"CMS Report",data:()=>({search:null,listing:[],listingOld:[],isLoading:!1,isDataView:!1,timeout:null,dataView:!1,chart:{},chartData:{},headers:{},fields:{},data:{},totalItems:{},routerList:{},dataListing:{},limit:25,isLoadDataView:!0,exportName:"report"}),mounted(){this.create(),this.id&&this.itemClick(this.id)},methods:{checkChart(){return"object"==typeof this.chart?0==this.chart.length?"px-4 py-4 mb-5 d-none":"px-4 py-4 mb-5 reportChartWrapper":"px-4 py-4 mb-5 d-none"},create(){fetch(route("cms_vuetify_report_listing"),{method:"POST"}).then((t=>{if(t.ok)return t.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((t=>{this.listing=t,this.listingOld=t})).catch((t=>{console.error(t)}))},handleClearableClick(){this.exportName="",this.listing=this.listingOld,this.dataView=!1},fetchSearchData(){if(this.search){this.handleClearableClick();const t=new FormData;t.append("search",JSON.stringify({id:this.search,niceName:this.search})),fetch(route("cms_vuetify_report_listing"),{method:"POST",body:t}).then((t=>{if(t.ok)return t.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((t=>{this.listing=t})).catch((t=>{console.error(t)})),this.isLoading=!1}else this.isLoading=!1,this.handleClearableClick()},itemClick(t){const e=new URL(window.location.href);e.searchParams.set("id",t),window.history.replaceState({},"",e),this.exportName=t,this.dataView=!1,this.chartData={};const a=new FormData;a.append("id",t),a.append("checkJson",!0),fetch(route("cms_vuetify_report_detail"),{method:"POST",body:a}).then((t=>{if(t.ok)return t.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.chart=e.chart,this.chartData=e.chartData,this.dataListing=e.listing,this.headers=e.fields,this.fields=e.fields,this.totalItems=e.totalItems,this.routerList={router:"/cms/report/detail?id="+[t]},this.limit=e.limit,this.dataView=!0})).catch((t=>{console.error(t)})),this.isDataView=!1},exportExcel(){let t=new FormData;if(this.data){for(var[e,a]of Object.entries(this.data))t.append("data[]",JSON.stringify(a));var i=this.fields;t.append("fields",JSON.stringify(i)),this.loading=!0,fetch(route("vuetify_export_excel"),{method:"POST",body:t}).then((t=>t.blob())).then((t=>{const e=URL.createObjectURL(t);console.log(e);const a=document.createElement("a");a.href=e,a.download=[this.exportName]+".xlsx",a.click(),URL.revokeObjectURL(e)})).catch((t=>{console.log(t)})).finally((()=>{this.loading=!1}))}}}},V=Object.assign(N,{layout:m},{props:{id:String},setup:m=>(m,N)=>{const V=t("v-icon"),T=t("v-text-field"),P=t("v-progress-linear"),U=t("v-list-item"),W=t("v-list"),E=t("PieChart"),R=t("LineChart"),F=t("BarChart"),I=t("v-btn"),J=t("CustomField"),B=t("DataTableServer");return e(),a("div",f,[i("div",u,[i("div",v,[r(V,{icon:"mdi-chart-line",class:"--objectIcon me-3"}),g]),x]),i("div",y,[i("div",w,[i("div",b,[i("div",k,[r(T,{label:"Search",variant:"outlined",density:"compact","bg-color":"white","hide-details":"",modelValue:m.search,"onUpdate:modelValue":N[1]||(N[1]=t=>m.search=t),clearable:"",class:"mb-5",onKeydown:N[2]||(N[2]=o((t=>m.fetchSearchData()),["enter"])),"onClick:clear":N[3]||(N[3]=t=>m.handleClearableClick())},{"append-inner":s((()=>[r(V,{onClick:N[0]||(N[0]=t=>m.fetchSearchData())},{default:s((()=>[l("mdi-magnify")])),_:1})])),_:1},8,["modelValue"])]),i("div",C,[m.isLoading?(e(),c(P,{key:0,active:m.isLoading,indeterminate:""},null,8,["active"])):n("",!0),r(W,{density:"compact",class:"--reportList pa-0"},{default:s((()=>[(e(!0),a(h,null,d(m.listing,(t=>(e(),c(U,{key:t.id,title:t.niceName,subtitle:t.id,class:p([{"v-list-item--active active":m.exportName===t.id},"itemDataSearch"]),onClick:e=>m.itemClick(t.id)},null,8,["title","subtitle","class","onClick"])))),128))])),_:1})])]),m.dataView?(e(),a("div",D,[i("div",{class:p(m.checkChart())},["pie"==m.chart.type&&m.chartData?(e(),c(E,{key:0,chartData:m.chartData},null,8,["chartData"])):n("",!0),"line"==m.chart.type&&m.chartData?(e(),c(R,{key:1,chartData:m.chartData},null,8,["chartData"])):n("",!0),"bar"==m.chart.type&&m.chartData?(e(),c(F,{key:2,chartData:m.chartData},null,8,["chartData"])):n("",!0)],2),i("div",L,[i("div",S,[r(I,{variant:"text","prepend-icon":"mdi-microsoft-excel",onClick:N[4]||(N[4]=t=>m.exportExcel())},{default:s((()=>[l(" Export ")])),_:1}),r(J,{headers:m.headers,list:m.fields,"onUpdate:headers":N[5]||(N[5]=t=>m.headers=t)},null,8,["headers","list"])]),i("div",j,[r(B,{listing:m.dataListing,router:m.routerList,"total-items":m.totalItems,headers:m.headers,limit:m.limit,fetchData:!0,multipleSelecte:!1,"onUpdate:chartData":N[6]||(N[6]=t=>m.chartData=t),"onUpdate:data":N[7]||(N[7]=t=>m.data=t)},null,8,["listing","router","total-items","headers","limit"])])])])):(e(),a("div",O,_))])])])}});export{V as default};
