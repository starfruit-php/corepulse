import{v as e,m as t,q as o,r as i,o as l,h as n,f as a,a as d,w as s,d as r,i as c,t as p,c as m,u,T as h,F as f,l as g,n as x,b as w,s as y,V as v}from"./app-ff71be3c.js";import k from"./Layout-c90d177d.js";import b from"./ModalEditName-13b9f74b.js";const _={class:"mainAppWrapper d-flex flex-column"},C={class:"mainBarWrapper px-5 py-3 d-flex justify-space-between align-center flex-grow-0 flex-shrink-0"},F={class:"--left d-flex align-center"},D={class:"--listing"},T=a("div",{class:"d-flex flex-column me-4"},[a("h3",{class:"--objectTitle me-4"},"Assets")],-1),I=a("div",{class:"utilityBarWrapper flex-grow-0 flex-shrink-0"},null,-1),S={class:"mainContentWrapper px-5 py-4 d-flex flex-column flex-grow-1 flex-shrink-1 overflow-hidden"},E={class:"tableListingWrapper d-flex flex-column flex-shrink-1 flex-grow-1 overflow-hidden",style:{padding:"0px"}},N={class:"d-flex h-100"},L={class:"--folderList w-25 h-100 d-flex flex-column pe-4 overflow-auto",style:{padding:"16px 24px 16px 24px"}},A={class:"--mediaToolbar mb-3 d-flex"},V={style:{display:"flex","align-items":"center"}},P={style:{display:"flex","align-items":"center",width:"100%","list-style-type":"none"}},j={style:{width:"100%"}},O=["data-node-id"],M=["src"],U=["data-node-id"],W=["src"],B={class:"w-75 h-100 d-flex flex-column ps-5",style:{background:"#F4F6F8",padding:"16px 24px 16px 24px"}},$={class:"control_order d-flex justify-space-between"},q={class:"--left"},G={class:"--right d-flex align-center"},K=a("span",{class:"me-2"},"Display",-1),X={class:"group_display d-flex me-4",style:{background:"#fff","border-radius":"10px",padding:"2px"}},Y={class:"group_filter d-flex me-4",style:{background:"#fff","border-radius":"10px",padding:"2px"}},H={class:"d-flex",style:{background:"#fff","border-radius":"10px",padding:"2px"}},R={class:"--mediaList overflow-auto"},z={class:"--mediaList overflow-auto"},J={class:"gridAssetListingWrapper flex-shrink-1 flex-grow-1 overflow-auto",relative:""},Q={id:"app"},Z={class:"--formContent componentField-input"},ee=a("label",null,"Folder Name",-1),te=e(o,t),oe={name:"Asset",components:{draggable:v,FilePond:te},props:{nameParent:Object,listAsset:Array,nameFoldes:String},data:()=>({home:{},nodes:{},config:{},objectSelect:[],showTree:!1,dialogFilepond:!1,showNewFolderDialog:!1,isLoading:!1,listImage:[],checkbox:1,contextMenuStates:{},dialogExport:!1,dialogEdit:!1,parentId:1,orderKey:"filename",order:"ASC"}),mounted(){this.fetchFolderDataOnce(),this.$nextTick((()=>{this.getTree()}))},methods:{fetchFolderData(){const e=new FormData;var t="get_folder";"admin"==window.location.pathname.split("/")[1]&&(t="get_folder_admin",e.append("csrfToken",this.csrf_token)),this.checkType&&e.append("types",this.checkType),fetch(route(t),{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.listImage=e.images})).catch((e=>{console.error(e)}))},fetchData(e){this.isLoading=!0;var t="get_asset";return"admin"==window.location.pathname.split("/")[1]&&(t="get_asset_admin",e.append("csrfToken",this.csrf_token)),fetch(route(t),{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.listImage=e.data,this.nameParent=e.nameParent,this.parentId=e.parentId})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},fetchFolderDataOnce(){this.foldersLoaded||(this.fetchFolderData(),this.foldersLoaded=!0,this.selectedFolderId=1)},showContextMenu(e,t){for(const a in this.contextMenuStates)this.contextMenuStates[a].visible=!1;const o=window.innerWidth,i=window.innerHeight;let l=e.clientX,n=e.clientY;e.clientX+300>o&&(l=o-300),e.clientY+300>i&&(n=i-300),this.contextMenuStates[t.id]={x:l+"px",y:n+"px",visible:!0}},detailItem(e){const t=e.id,o=new FormData;let i="";const l=new URLSearchParams(window.location.search).get("layout");l&&(i=l),o.append("layout",i),this.$inertia.post("/cms/asset/detail/"+t,o)},openNewFolderDialog(){this.showNewFolderDialog=!0},closeNewFolderDialog(){this.showNewFolderDialog=!1,this.newFolderName=""},showDataFolder(e){this.selectedFolderId=e;const t=this.searchInput,o=this.selectTypes,i=new FormData;i.append("id",e),i.append("search",t),i.append("types",o),this.fetchData(i)},sortItem(){var e=this.orderKey,t="";if("DESC"==this.order)t="ASC";else t="DESC";const o=new FormData;o.append("id",this.parentId),o.append("order_by",e),o.append("order",t),this.fetchData(o),this.order=t},nodeOpenedAction(e){this.$nextTick((()=>{e.children=[],this.isLoading=!0,this.updateChildren(e)}))},nodeClosedAction(e){},nodeToggleAction(e){},nodeBlurAction(e){},nodeFocusAction(e){this.showDataFolder(e.id)},updateChildren(e){const t=e.id,o=this.objectSelect;let i=new FormData;i.append("id",t),o.forEach(((e,t)=>{i.append("config[]",e)})),fetch(route("tree_children_asset"),{method:"POST",body:i}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.nodes={...this.nodes,...e.nodes},e.children||(this.nodes[t].state.indeterminate=!0),this.nodes[t].children=e.children,this.isLoading=!1})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},getTree(){this.isLoading=!0;let e=new FormData;var t="tree_listing_asset";"admin"==window.location.pathname.split("/")[1]&&(t="tree_listing_asset_admin",e.append("csrfToken",this.csrf_token)),fetch(route(t),{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.$nextTick((()=>{this.nodes=e.nodes,this.config=e.config,this.home=e.home,this.showTree=!0}))})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},clearNodeChecked(e){this.nodes[e.id].state.checked=!1,this.nodeChecked=this.nodeChecked.filter((t=>t.id!==e.id))}}},ie=Object.assign(oe,{layout:k},{setup(e){return(e,t)=>{const o=i("v-icon"),v=i("v-btn"),k=i("v-tooltip"),oe=i("v-progress-linear"),ie=i("v-img"),le=i("v-card-text"),ne=i("v-list-item-title"),ae=i("v-list-item"),de=i("v-list"),se=i("v-menu"),re=i("v-card"),ce=i("v-dialog"),pe=i("v-toolbar-title"),me=i("v-toolbar"),ue=i("v-text-field"),he=i("v-card-actions");return l(),n(f,null,[a("div",_,[a("div",C,[a("div",F,[a("div",{class:"--objectIcon me-3",onClick:t[0]||(t[0]=t=>e.back(e.breadcrumb.root.id))},[a("div",D,[d(o,{icon:"mdi-image-outline"}),d(o,{icon:"mdi-arrow-left"}),d(o,{icon:"mdi-image-outline"})])]),T])]),I,a("div",S,[a("div",E,[a("div",N,[a("div",L,[a("div",A,[d(v,{style:{"box-shadow":"none"},class:"btn-primary me-2","prepend-icon":"mdi-folder-plus",onClick:e.openNewFolderDialog},{default:s((()=>[r(" New Folder ")])),_:1},8,["onClick"])]),a("div",V,[a("ul",P,[a("li",j,[a("div",{class:"node-wrapper",style:{display:"flex"},onClick:t[1]||(t[1]=t=>e.showDataFolder(e.home.id))},[a("div",{class:"data-node-id text-title","data-node-id":e.home.id},[e.home.image?(l(),n("img",{key:0,src:e.home.image,alt:"Folder Icon",class:"folder-image"},null,8,M)):c("",!0),r(" "+p(e.home.key),1)],8,O),d(k,{activator:"parent",location:"start"},{default:s((()=>[a("strong",null,"ID: "+p(e.home.id),1),r(" | Type: "+p(e.home.type),1)])),_:1})])])])]),1==e.showTree?(l(),m(u(h),{key:e.nodes,config:e.config,nodes:e.nodes,onNodeOpened:t[2]||(t[2]=t=>e.nodeOpenedAction(t)),onNodeClosed:t[3]||(t[3]=t=>e.nodeClosedAction(t)),onNodeFocus:t[4]||(t[4]=t=>e.nodeFocusAction(t)),onNodeToggle:t[5]||(t[5]=t=>e.nodeToggleAction(t)),onNodeBlur:t[6]||(t[6]=t=>e.nodeBlurAction(t))},{"after-input":s((e=>[a("div",{class:"data-node-id text-title","data-node-id":e.node.id},[e.node.image?(l(),n("img",{key:0,src:e.node.image,alt:"Folder Icon",class:"folder-image"},null,8,W)):c("",!0),r(" "+p(e.node.key),1)],8,U),d(k,{activator:"parent",location:"start"},{default:s((()=>[a("strong",null,"ID: "+p(e.node.id),1),r(" | Type: "+p(e.node.type),1)])),_:2},1024)])),_:1},8,["config","nodes"])):c("",!0)]),a("div",B,[a("div",$,[a("div",q,[d(v,{style:{"box-shadow":"none"},class:"btn-primary me-2","prepend-icon":"mdi-cloud-upload",onClick:t[7]||(t[7]=t=>e.dialogFilepond=!0)},{default:s((()=>[r(" Upload ")])),_:1})]),a("div",G,[K,a("div",X,[d(v,{class:"btn-icon me-2 btn-primary","prepend-icon":"mdi-table"}),d(v,{class:"btn-icon","prepend-icon":"mdi-view-grid-outline"})]),a("div",Y,[d(v,{class:"btn-icon me-2 icon_setting","prepend-icon":"mdi-cog"}),d(v,{class:"btn-icon me-2","prepend-icon":"mdi-order-alphabetical-descending",onClick:e.sortItem},null,8,["onClick"]),d(v,{class:"btn-icon me-2","prepend-icon":"mdi-format-list-bulleted-square"}),d(v,{class:"btn-icon me-2","prepend-icon":"mdi-filter-outline"}),d(v,{class:"btn-icon","prepend-icon":"mdi-magnify"})]),a("div",H,[d(v,{variant:"text",class:"btn_export","prepend-icon":"mdi-microsoft-excel",onClick:e.exportExcel},{default:s((()=>[r(p(e.$t("Export")),1)])),_:1},8,["onClick"])])])]),a("div",R,[e.isLoading?(l(),m(oe,{key:0,active:e.isLoading,indeterminate:""},null,8,["active"])):c("",!0),a("div",z,[e.isLoading?(l(),m(oe,{key:0,active:e.isLoading,indeterminate:""},null,8,["active"])):c("",!0),a("div",J,[(l(!0),n(f,null,g(e.listImage,(t=>(l(),m(re,{key:t.id,onContextmenu:w((o=>e.showContextMenu(o,t)),["prevent"]),onClick:o=>e.detailItem(t),class:"itemAssetGrid"},{default:s((()=>[d(ie,{src:t.fullPath,"aspect-ratio":"1",cover:""},null,8,["src"]),d(le,null,{default:s((()=>[r(p(t.name),1)])),_:2},1024),d(k,{activator:"parent",location:"bottom"},{default:s((()=>[r(p(t.name),1)])),_:2},1024),e.contextMenuStates[t.id]?(l(),m(se,{key:0,modelValue:e.contextMenuStates[t.id].visible,"onUpdate:modelValue":o=>e.contextMenuStates[t.id].visible=o,style:x({top:e.contextMenuStates[t.id].y,left:e.contextMenuStates[t.id].x}),absolute:"","offset-y":""},{default:s((()=>[d(de,{density:"compact"},{default:s((()=>[d(ae,{onClick:o=>e.detailItem(t)},{prepend:s((()=>[d(o,{icon:"mdi-eye-outline"})])),default:s((()=>[d(ne,null,{default:s((()=>[r("Detail")])),_:1})])),_:2},1032,["onClick"]),"folder"==t.type?(l(),m(ae,{key:0,onClick:o=>e.handleModalEdit(t)},{prepend:s((()=>[d(o,{icon:"mdi-pencil-outline"})])),default:s((()=>[d(ne,null,{default:s((()=>[r("Edit")])),_:1})])),_:2},1032,["onClick"])):c("",!0),"folder"!=t.type?(l(),m(ae,{key:1,onClick:o=>e.handleModalExport(t)},{prepend:s((()=>[d(o,{icon:"mdi-cloud-download-outline"})])),default:s((()=>[d(ne,null,{default:s((()=>[r("Download")])),_:1})])),_:2},1032,["onClick"])):c("",!0),d(ae,{onClick:o=>e.deleteItem(t)},{prepend:s((()=>[d(o,{icon:"mdi-delete-outline"})])),default:s((()=>[d(ne,null,{default:s((()=>[r("Delete")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","style"])):c("",!0)])),_:2},1032,["onContextmenu","onClick"])))),128)),d(ce,{modelValue:e.dialogEdit,"onUpdate:modelValue":t[9]||(t[9]=t=>e.dialogEdit=t),width:"420"},{default:s((()=>[d(re,null,{default:s((()=>[d(b,{"onUpdate:dialog":t[8]||(t[8]=t=>e.dialogEdit=t),item:e.itemEdit,url:{path:"vuetify_asset_edit_name",parentId:this.parentId}},null,8,["item","url"])])),_:1})])),_:1},8,["modelValue"]),d(ce,{modelValue:e.dialogExport,"onUpdate:modelValue":t[11]||(t[11]=t=>e.dialogExport=t),width:"420"},{default:s((()=>[d(re,null,{default:s((()=>[d(y,{"onUpdate:dialog":t[10]||(t[10]=t=>e.dialogExport=t),item:e.itemExport},null,8,["item"])])),_:1})])),_:1},8,["modelValue"])])])])])])])])]),d(ce,{modelValue:e.dialogFilepond,"onUpdate:modelValue":t[12]||(t[12]=t=>e.dialogFilepond=t),ref:"modalContent",class:"dialog-mediaLibrary",width:"500"},{default:s((()=>[a("div",Q,[d(u(te),{name:"test",ref:"pond","label-idle":"Drop files here or <span class='filepond--label-action'>Browse</span>","allow-multiple":!0,server:"/cms/save-image",files:e.myFiles,onInit:e.handleFilePondInit,onProcessfile:e.handleProcessFile,onAddfile:e.filesChange},null,8,["files","onInit","onProcessfile","onAddfile"])])])),_:1},8,["modelValue"]),d(ce,{modelValue:e.showNewFolderDialog,"onUpdate:modelValue":t[14]||(t[14]=t=>e.showNewFolderDialog=t),class:"dialogGeneralWrapper","max-width":"400"},{default:s((()=>[d(re,null,{default:s((()=>[d(me,{density:"compact"},{default:s((()=>[d(pe,{text:"Create Folder",class:""})])),_:1}),d(le,null,{default:s((()=>[a("div",Z,[ee,d(ue,{variant:"outlined",density:"compact","bg-color":"white",modelValue:e.newFolderName,"onUpdate:modelValue":t[13]||(t[13]=t=>e.newFolderName=t),rules:[e=>!!e||"Name is required"],required:""},null,8,["modelValue","rules"])])])),_:1}),d(he,{class:"justify-end"},{default:s((()=>[d(v,{color:"",variant:"text",onClick:e.closeNewFolderDialog},{default:s((()=>[r("Cancel ")])),_:1},8,["onClick"]),d(v,{variant:"elevated",class:"btn-primary",onClick:e.createNewFolder},{default:s((()=>[r(" Create ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}});export{ie as default};
