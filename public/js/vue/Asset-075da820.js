import{v as e,m as t,q as l,r as a,o as i,h as s,c as o,w as d,d as n,t as r,i as c,f as u,a as p,F as m,l as h,u as f,n as g,b as y,s as w,V as v,x as b,y as x,M as I,k as F}from"./app-5e568705.js";import _ from"./Layout-be75e8f8.js";import C from"./ModalEditName-15fccc2a.js";const k={class:"mainAppWrapper d-flex flex-column"},D={class:"mainBarWrapper px-5 py-3 d-flex justify-space-between align-center flex-grow-0 flex-shrink-0"},A={class:"--left d-flex align-center"},U={class:"--listing"},N={class:"d-flex flex-column me-4"},E=u("span",null,"Home",-1),M=u("span",{class:"--divider"},"·",-1),S=u("span",{class:"--divider"},"·",-1),T=u("h3",{class:"--objectTitle me-4"},"Assets",-1),V={class:"--right"},P={class:"--formContent componentField-input"},L=u("label",null,"Folder Name",-1),j={id:"app"},O=u("div",{class:"utilityBarWrapper flex-grow-0 flex-shrink-0"},null,-1),$={class:"mainContentWrapper px-5 py-4 d-flex flex-column flex-grow-1 flex-shrink-1 overflow-hidden"},R={key:0,class:"tableListingWrapper d-flex flex-column flex-shrink-1 flex-grow-1 overflow-hidden"},W={key:1,class:"gridAssetListingWrapper flex-shrink-1 flex-grow-1 overflow-auto",relative:""},q=e(l,t),B={name:"Asset",components:{draggable:v,FilePond:q},props:{nameParent:Object,listAsset:Array,nameFoldes:String},data(){var e=window.location.href;let t=window.localStorage.getItem(e);t?t=JSON.parse(t):(t=[{title:"File",align:"start",key:"fileName",sortable:!0,removable:!0,handleClick:!0,url:"vuetify_asset_detail"},{title:"Fomat",key:"fomat",sortable:!0,removable:!0},{title:"Type",key:"type",sortable:!0,removable:!0},{title:"Size",key:"size",sortable:!1,removable:!0},{title:"Date created",key:"creationDate",sortable:!0,removable:!0,searchType:"Date"}],window.localStorage.setItem(e,JSON.stringify(t)));var l=[];t.map((e=>{e.removable&&l.push(e)}));var a=[];(this.permission.includes("assetsView")||1==this.defaultAdmin)&&a.push(this.createAction("Detail","mdi-eye-outline","detail","vuetify_asset_detail",!1,!1,!1)),(this.permission.includes("assetsView")||1==this.defaultAdmin)&&a.push(this.createAction("Edit","mdi-pencil-outline","edit",{path:"vuetify_asset_edit_name",parentId:this.folderId_url},C,!1,!1)),(this.permission.includes("assetsDelete")||1==this.defaultAdmin)&&a.push(this.createAction("Delete","mdi-delete-outline","delete","vuetify_asset_delete",b,!0)),a.push(this.createAction("Download","mdi-cloud-download-outline","download",{path:"vuetify_asset_download"},w,!1,!1));var i=[{title:"Delete",icon:"mdi-delete-outline",url:{path:"vuetify_asset_delete",content:{title:"Delete",content:"Are you sure you want to Delete all selected",confirm:"Delete"},data:{test:"1"}},component:I,post:!0,reload:!1}],s=new URLSearchParams(window.location.search),o=s.get("folderId"),d=s.get("layout"),n="/cms/asset/upload-file",r=[];return o&&(console.log(o),r={folderId:o},n="/cms/asset/upload-file?folderId="+o),d&&(r={layout:this.displayType!=d?"list":d}),o&&d&&(r={folderId:o,layout:d}),{ModalSelected:x(I),ModalDelete:x(b),ModalExportImage:x(w),ModalEditName:x(C),fav:!0,menu:!1,message:!1,hints:!0,enabled:!0,object:this.listAsset,itemsPerPage:5,headers:l,desserts:this.listAsset,list:t,dragging:!1,selected:[],routerList:{router:route("vuetify_asset",r)},action:a,showNewFolderDialog:!1,newFolderName:"",displayType:d||"list",contextMenuStates:{},draggedItem:null,targetItem:null,draggedItemId:null,draggedItemIndex:null,isLoadingMoreData:!1,successMessage:null,errorMessage:null,folderNewUpload:[],toast:F.useToast({position:"top-right"}),dialogFilepond:!1,myFiles:[],ulrUpload:n,rules:[e=>!!e||"Required."],selectedAction:i,uploadedFilesCount:0,filesUpload:0,dialogExport:!1,radiosType:1,dialogEdit:!1,folderId_url:o,itemExport:{},itemEdit:{},idUrl:""}},watch:{headers(){}},mounted(){this.$nextTick((()=>{this.$refs.myComponentElement&&window.addEventListener("scroll",this.handleScroll)}))},methods:{createAction:(e,t,l,a,i=!1,s=!0,o=!0,d=!0)=>({title:e,icon:t,key:l,url:a,component:i,post:o,reload:d,multiple:s}),showList(){const e=new URLSearchParams(window.location.search).get("folderId");e&&(this.routerList={router:route("vuetify_asset",{folderId:e})}),this.displayType="list"},showGrid(){this.displayType="grid"},handleModalExport(e){this.dialogExport=!0,this.itemExport=e},handleModalEdit(e){this.dialogEdit=!0,this.idUrl=this.folderId_url,this.itemEdit=e},showContextMenu(e,t){for(const o in this.contextMenuStates)this.contextMenuStates[o].visible=!1;const l=window.innerWidth,a=window.innerHeight;let i=e.clientX,s=e.clientY;e.clientX+300>l&&(i=l-300),e.clientY+300>a&&(s=a-300),this.contextMenuStates[t.id]={x:i+"px",y:s+"px",visible:!0}},handleScroll(){const e=this.$refs.myComponentElement;e.scrollTop,e.clientHeight,e.scrollHeight},onDragStart(e,t){e.dataTransfer.setData("text/plain",t.id),this.draggedItemId=t.id,this.draggedItemIndex=this.listAsset.findIndex((e=>e.id===t.id))},onDragOver(e){e.preventDefault()},onDrop(e,t){e.preventDefault();const l=t.id;if(this.listAsset.findIndex((e=>e.id===l)),this.draggedItemId!==l){const e=new FormData;e.append("id",this.draggedItemId),e.append("parentId",l);let t="",a="";const i=new URLSearchParams(window.location.search),s=i.get("folderId"),o=i.get("layout");s&&(t=s),o&&(a=o),e.append("folderId",t),e.append("layout",a),this.$inertia.post("/cms/asset/move",e),this.draggedItemId=null,this.draggedItemIndex=null}},openNewFolderDialog(){this.showNewFolderDialog=!0},closeNewFolderDialog(){this.showNewFolderDialog=!1,this.newFolderName=""},createNewFolder(){const e=this.newFolderName;if(void 0!==e&&""!==e.trim()){let t="";const l=new URLSearchParams(window.location.search).get("folderId");l&&(t=l);const a=new FormData;a.append("parentId",t),a.append("nameFolder",e),this.$inertia.post("/cms/asset/upload-folder",a),this.newFolderName="",this.showNewFolderDialog=!1,setTimeout((()=>{this.flash.success&&this.toast.open({message:this.flash.success,type:"success"});var e=this.flash.errors.key??"",t=this.flash.errors.message??this.flash.errors;this.flash.errors&&this.toast.open({message:e+" "+t,type:"error"})}),1e3),this.closeNewFolderDialog()}else setTimeout((()=>{this.toast.open({message:"Folder Name is required!",type:"error"})}),1e3)},detailItem(e){const t=e.id,l=new FormData;let a="";const i=new URLSearchParams(window.location.search).get("layout");i&&(a=i),l.append("layout",a),this.$inertia.post("/cms/asset/detail/"+t,l)},exportItem(e){if("folder"!=e.type){var t=e.urlDownload;const l=document.createElement("a");l.href=t,l.download="",document.body.appendChild(l),l.click(),document.body.removeChild(l)}},navigateToFolder(){this.$inertia.post("/cms/asset/listing"),this.ulrUpload="/cms/asset/upload-file"},navigateToFolderChill(e){this.$inertia.post("/cms/asset/listing?folderId="+e.id)},copyToClipboard(e){const t=document.createElement("textarea");t.value=e.raw.publicURL,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},deleteItem(e){const t=e.id,l=new FormData;l.append("id",t);let a="";const i=new URLSearchParams(window.location.search).get("folderId");i&&(a=i),l.append("folderId",a),this.$inertia.post("/cms/asset/delete",l)},extractItem(e){const t=e.id,l=new FormData;l.append("id",t);let a="";const i=new URLSearchParams(window.location.search).get("folderId");i&&(a=i),l.append("folderId",a),this.$inertia.post("/cms/asset/extract-file",l)},handleFilePondInit(){this.$refs.pond.getFiles()},filesChange:function(e,t){window.abc=t;let l=new URLSearchParams(window.location.search).get("folderId");var a=t.file._relativePath;t.setMetadata("parentId",l),a&&t.setMetadata("path",a),this.uploadedFilesCount=0,this.filesUpload++},handleProcessFile(e){if(this.uploadedFilesCount++,this.uploadedFilesCount===this.filesUpload){let e=new URLSearchParams(window.location.search).get("folderId");e?this.$inertia.post("/cms/asset/listing?folderId="+e):this.$inertia.post("/cms/asset/listing"),setTimeout((()=>{this.toast.open({message:"Upload the file successfully",type:"success"}),this.dialogFilepond=!1,this.dialog=!1}),1e3)}}}},H=Object.assign(B,{layout:_},{props:{listAsset:Object,nameParent:Object,totalItems:Number,defaultAdmin:Number,permission:Array,flash:Object,chips:[Object,Array],nameFoldes:String,noOrder:[Object,Array]},setup(e){return(t,l)=>{const v=a("v-alert"),b=a("v-icon"),x=a("v-breadcrumbs-item"),I=a("v-breadcrumbs"),F=a("v-btn"),_=a("v-toolbar-title"),B=a("v-toolbar"),H=a("v-text-field"),G=a("v-card-text"),z=a("v-card-actions"),J=a("v-card"),X=a("v-dialog"),Y=a("v-btn-toggle"),K=a("DataTableServer"),Q=a("v-img"),Z=a("v-list-item-title"),ee=a("v-list-item"),te=a("v-list"),le=a("v-menu");return i(),s(m,null,[t.successMessage?(i(),o(v,{key:0,type:"success",dismissible:""},{default:d((()=>[n(r(t.successMessage),1)])),_:1})):c("",!0),t.errorMessage?(i(),o(v,{key:1,type:"error",dismissible:""},{default:d((()=>[n(r(t.errorMessage),1)])),_:1})):c("",!0),u("div",k,[u("div",D,[u("div",A,[u("div",{class:"--objectIcon me-3",onClick:l[0]||(l[0]=e=>t.back(t.breadcrumb.root.id))},[u("div",U,[p(b,{icon:"mdi-image-outline"}),p(b,{icon:"mdi-arrow-left"}),p(b,{icon:"mdi-image-outline"})])]),u("div",N,[p(I,{class:"breadcrumbWrapper pa-0"},{default:d((()=>[p(x,{class:"--itemBreadcrumb",disabled:!e.nameParent,onClick:t.navigateToFolder,title:"Home"},{default:d((()=>[E])),_:1},8,["disabled","onClick"]),M,(i(!0),s(m,null,h(e.nameParent,((e,l)=>(i(),s(m,{key:l},[e?(i(),o(x,{key:0,onClick:l=>t.navigateToFolderChill(e),class:"--itemBreadcrumb",disabled:e.end},{default:d((()=>[u("span",null,r(e.name),1)])),_:2},1032,["onClick","disabled"])):c("",!0),S],64)))),128))])),_:1}),T])]),u("div",V,[e.permission.includes("assetsCreate")||1==e.defaultAdmin?(i(),o(F,{key:0,class:"btn-primary me-2","prepend-icon":"mdi-cloud-upload",onClick:l[1]||(l[1]=e=>t.dialogFilepond=!0)},{default:d((()=>[n(" Upload ")])),_:1})):c("",!0),e.permission.includes("assetsCreate")||1==e.defaultAdmin?(i(),o(F,{key:1,class:"btn-primary me-2","prepend-icon":"mdi-folder-plus",onClick:t.openNewFolderDialog},{default:d((()=>[n(" New Folder ")])),_:1},8,["onClick"])):c("",!0),u("input",{ref:"fileInput",type:"file",style:{display:"none"},onChange:l[2]||(l[2]=(...e)=>t.handleFileUpload&&t.handleFileUpload(...e))},null,544),p(X,{modelValue:t.showNewFolderDialog,"onUpdate:modelValue":l[4]||(l[4]=e=>t.showNewFolderDialog=e),class:"dialogGeneralWrapper","max-width":"400"},{default:d((()=>[p(J,null,{default:d((()=>[p(B,{density:"compact"},{default:d((()=>[p(_,{text:"Create Folder",class:""})])),_:1}),p(G,null,{default:d((()=>[u("div",P,[L,p(H,{variant:"outlined",density:"compact","bg-color":"white",modelValue:t.newFolderName,"onUpdate:modelValue":l[3]||(l[3]=e=>t.newFolderName=e),rules:[e=>!!e||"Name is required"],required:""},null,8,["modelValue","rules"])])])),_:1}),p(z,{class:"justify-end"},{default:d((()=>[p(F,{color:"",variant:"text",onClick:t.closeNewFolderDialog},{default:d((()=>[n("Cancel ")])),_:1},8,["onClick"]),p(F,{variant:"elevated",class:"btn-primary",onClick:t.createNewFolder},{default:d((()=>[n(" Create ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),p(X,{modelValue:t.dialogFilepond,"onUpdate:modelValue":l[5]||(l[5]=e=>t.dialogFilepond=e),ref:"modalContent",class:"dialog-mediaLibrary",width:"500"},{default:d((()=>[u("div",j,[p(f(q),{name:"test",ref:"pond","label-idle":"Drop files here or <span class='filepond--label-action'>Browse</span>","allow-multiple":!0,server:"/cms/asset/upload-file",files:t.myFiles,onInit:t.handleFilePondInit,onProcessfile:t.handleProcessFile,onAddfile:t.filesChange},null,8,["files","onInit","onProcessfile","onAddfile"])])])),_:1},8,["modelValue"]),p(Y,{modelValue:t.displayType,"onUpdate:modelValue":l[6]||(l[6]=e=>t.displayType=e),color:"primary",mandatory:""},{default:d((()=>[p(F,{icon:"list"==t.displayType?"mdi-table":"mdi-table-off",value:"list"},null,8,["icon"]),p(F,{icon:"grid"==t.displayType?"mdi-grid":"mdi-grid-off",value:"grid"},null,8,["icon"])])),_:1},8,["modelValue"])])]),O,u("div",$,["list"===t.displayType?(i(),s("div",R,[p(K,{listing:e.listAsset,router:t.routerList,"total-items":e.totalItems,headers:t.headers,action:t.action,chips:e.chips,selectedAction:t.selectedAction,noOrder:e.noOrder},null,8,["listing","router","total-items","headers","action","chips","selectedAction","noOrder"])])):c("",!0),"grid"===t.displayType?(i(),s("div",W,[(i(!0),s(m,null,h(e.listAsset,(e=>(i(),o(J,{key:e.id,onContextmenu:y((l=>t.showContextMenu(l,e)),["prevent"]),onClick:l=>t.detailItem(e),class:"itemAssetGrid"},{default:d((()=>[p(Q,{src:e.publicURL,"aspect-ratio":"1",cover:""},null,8,["src"]),p(G,null,{default:d((()=>[n(r(e.file),1)])),_:2},1024),t.contextMenuStates[e.id]?(i(),o(le,{key:0,modelValue:t.contextMenuStates[e.id].visible,"onUpdate:modelValue":l=>t.contextMenuStates[e.id].visible=l,style:g({top:t.contextMenuStates[e.id].y,left:t.contextMenuStates[e.id].x}),absolute:"","offset-y":""},{default:d((()=>[p(te,{density:"compact"},{default:d((()=>[p(ee,{onClick:l=>t.detailItem(e)},{prepend:d((()=>[p(b,{icon:"mdi-eye-outline"})])),default:d((()=>[p(Z,null,{default:d((()=>[n("Detail")])),_:1})])),_:2},1032,["onClick"]),"folder"==e.type?(i(),o(ee,{key:0,onClick:l=>t.handleModalEdit(e)},{prepend:d((()=>[p(b,{icon:"mdi-pencil-outline"})])),default:d((()=>[p(Z,null,{default:d((()=>[n("Edit")])),_:1})])),_:2},1032,["onClick"])):c("",!0),"folder"!=e.type?(i(),o(ee,{key:1,onClick:l=>t.handleModalExport(e)},{prepend:d((()=>[p(b,{icon:"mdi-cloud-download-outline"})])),default:d((()=>[p(Z,null,{default:d((()=>[n("Download")])),_:1})])),_:2},1032,["onClick"])):c("",!0),p(ee,{onClick:l=>t.deleteItem(e)},{prepend:d((()=>[p(b,{icon:"mdi-delete-outline"})])),default:d((()=>[p(Z,null,{default:d((()=>[n("Delete")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","style"])):c("",!0)])),_:2},1032,["onContextmenu","onClick"])))),128)),p(X,{modelValue:t.dialogEdit,"onUpdate:modelValue":l[8]||(l[8]=e=>t.dialogEdit=e),width:"420"},{default:d((()=>[p(J,null,{default:d((()=>[p(C,{"onUpdate:dialog":l[7]||(l[7]=e=>t.dialogEdit=e),item:t.itemEdit,url:{path:"vuetify_asset_edit_name",parentId:this.folderId_url}},null,8,["item","url"])])),_:1})])),_:1},8,["modelValue"]),p(X,{modelValue:t.dialogExport,"onUpdate:modelValue":l[10]||(l[10]=e=>t.dialogExport=e),width:"420"},{default:d((()=>[p(J,null,{default:d((()=>[p(w,{"onUpdate:dialog":l[9]||(l[9]=e=>t.dialogExport=e),item:t.itemExport},null,8,["item"])])),_:1})])),_:1},8,["modelValue"])])):c("",!0)])])],64)}}});export{H as default};
