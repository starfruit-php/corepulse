import e from"./Layout-b42d48af.js";import"./vue-toast-notification-f2a3de7a.js";import{V as t}from"./vue-draggable-next-3bc70602.js";import a from"./ModalMetric-d6c2bc38.js";import s from"./ModalPoperty-37bfcdc9.js";import{V as i}from"./vue3-grid-layout-84b92012.js";import{am as l,o as r,c as o,a as c,k as d,q as n,A as h,N as p,E as m,M as u,C as g,K as f,p as y,L as v,G as w}from"./@vue-9ee83fb6.js";import"./@vueuse-3c3b27e0.js";import"./unidecode-5a54da0f.js";import"./@ckeditor-fa9b3055.js";import"./vue-abe8eda6.js";const C={class:"mainAppWrapper adminSettingWrapper d-flex flex-column"},D={class:"mainBarWrapper px-5 pt-3 flex-grow-0 flex-shrink-0"},k={class:"d-flex align-center"},x={class:"--left d-flex align-center"},b=c("div",{class:"d-flex flex-column me-4"},[c("h3",{class:"--objectTitle me-4"},"Plausible Widget")],-1),S={class:"--right"},P={class:"mainContentWrapper px-5 py-4 d-flex flex-column flex-grow-1 flex-shrink-1"},V={class:"d-flex",style:{gap:"10px"}},A=["src"],_=c("h3",{class:"mb-4",style:{"padding-left":"12px"}},"CHART WITH CUSTOM",-1),T={class:"h-100 d-flex flex-column pa-8"},R={class:"title d-flex",style:{"align-items":"center","justify-content":"space-between"}},j={class:"mb-4"},$={class:"filter d-flex",style:{"align-items":"center",gap:"20px",width:"150px"}},M={key:0,class:"flex-1-1 overflow-hidden"},O={key:1,class:"flex-1-1 overflow-hidden"},U=c("h3",{class:"mb-4",style:{"padding-left":"12px"}},"GENERAL CHART",-1),W={class:"h-100 d-flex flex-column pa-8"},F={class:"title d-flex",style:{"align-items":"center","justify-content":"space-between"}},E=c("h3",{class:"mb-4"},"Plausible",-1),I={class:"filter d-flex",style:{"align-items":"center",gap:"20px"}},L={key:0,class:"total-arr d-flex"},G=["onClick"],q={key:1,class:"flex-1-1 overflow-hidden"},B={class:"h-100 d-flex flex-column pa-8"},H={class:"title d-flex",style:{"align-items":"center","justify-content":"space-between"}},N=c("h3",{class:"mb-4"},"Top Pages",-1),z={class:"filter d-flex",style:{"align-items":"center",gap:"20px"}},K={key:0,class:"total-arr d-flex",style:{"justify-content":"end"}},J=["onClick"],Q={key:1,class:"flex-1-1 overflow-hidden"},X={class:"h-100 d-flex flex-column pa-8"},Y=c("div",{class:"title d-flex",style:{"align-items":"center","justify-content":"space-between"}},[c("h3",{class:"mb-4"},"Sources")],-1),Z={class:"flex-1-1 overflow-hidden"},ee={class:"h-100 d-flex flex-column pa-8"},te={class:"title d-flex",style:{"align-items":"center","justify-content":"space-between"}},ae=c("h3",{class:"mb-4"},"Devices",-1),se={class:"filter d-flex",style:{"align-items":"center",gap:"20px"}},ie={key:0,class:"total-arr d-flex",style:{"justify-content":"end"}},le=["onClick"],re={key:1,class:"flex-1-1 overflow-hidden"},oe={components:{draggable:t,GridLayout:i.GridLayout,GridItem:i.GridItem},data(){return{menu:!1,chartVies:this.chartVisitors,chartDevis:this.chartDevices,chartPages:this.chartTopPages,chartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{}}}},showChart:!0,showChartDevi:!0,showChartPages:!0,showVisi:!0,showPages:!0,showSources:!0,showDevi:!0,totalDevi:[{title:"browser"},{title:"os"},{title:"size"}],totalPages:[{title:"Top Pages"},{title:"Entry Pages"},{title:"Exit Pages"}],keyActive:"visitors",keyDeActive:"browser",keyPageActive:"Top Pages",url_logo:"",siteId:this.plausibleSetting?this.plausibleSetting.siteId:"",dialogCreateMetric:!1,timeSelect:"10 day",timeSelect4:"6 months",timeSelect2:"10 day",typeMetric:["visits","visitors","bounce_rate","pageviews"],selectTypeMetric:"visitors",dateRange:[],dateRange4:[],showCustomRange:!1,showCustomRange4:!1,showCustomRange2:!1,layout:[{x:0,y:0,w:6,h:13,i:"5"},{x:6,y:0,w:6,h:13,i:"6"},{x:0,y:1,w:6,h:13,i:"7"},{x:6,y:1,w:6,h:13,i:"8"}],dialogCreateProper:!1}},mounted(){if(this.siteId){const e="https://"+this.siteId;fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()})).then((t=>{const a=(new DOMParser).parseFromString(t,"text/html").querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]');let s="";a.length>0&&(s=a[0].getAttribute("href"),this.url_logo=e+s)})).catch((e=>{console.error("Error fetching website data:",e)}))}},computed:{arrTime:()=>["Today","7 day","10 day","30 day","6 months","12 months","Custom range"],arrTime2(){return this.arrTime},arrTime4(){return this.arrTime}},watch:{timeSelect(e){if("Custom range"===e)this.showCustomRange=!0;else{this.showCustomRange=!1,this.showChart=!1;const e=this.timeSelect,t=this.keyActive,a=new FormData;a.append("metrics",t),a.append("time",e),this.fetchData(a,t)}},dateRange(e){let t=this.dateRange.split("-").map((e=>e.trim())),a=t[1].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`)),s=t[0].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`));this.showChart=!1;const i=this.keyActive,l=new FormData;l.append("metrics",i),l.append("current_date",a),l.append("start_date",s),this.fetchData(l,i)},selectTypeMetric(e){this.showChartDevi=!1;const t=this.selectTypeMetric,a=this.keyDeActive,s=this.timeSelect4,i=new FormData;i.append("metrics",t),i.append("property",a),i.append("time",s),this.fetchDataDevi(i,a)},timeSelect4(e){if("Custom range"===e)this.showCustomRange4=!0;else{this.showCustomRange4=!1,this.showChartDevi=!1;const e=this.selectTypeMetric,t=this.keyDeActive,a=this.timeSelect4,s=new FormData;s.append("metrics",e),s.append("property",t),s.append("time",a),this.fetchDataDevi(s,t)}},dateRange4(e){let t=this.dateRange4.split("-").map((e=>e.trim())),a=t[1].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`)),s=t[0].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`));this.showChartDevi=!1;const i=this.selectTypeMetric,l=this.keyDeActive,r=new FormData;r.append("metrics",i),r.append("property",l),r.append("current_date",a),r.append("start_date",s),this.fetchDataDevi(r,l)},timeSelect2(e){if("Custom range"===e)this.showCustomRange2=!0;else{this.showCustomRange2=!1,this.showChartPages=!1;const e=this.keyPageActive,t=this.timeSelect2,a=new FormData;a.append("property",e),a.append("time",t),this.fetchDataPages(a,e)}},dateRange2(e){let t=this.dateRange2.split("-").map((e=>e.trim())),a=t[1].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`)),s=t[0].replace(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/,((e,t,a,s)=>`${t}-${a=a.padStart(2,"0")}-${s=s.padStart(2,"0")}`));this.showChartPages=!1;const i=this.keyPageActive,l=new FormData;l.append("property",i),l.append("current_date",a),l.append("start_date",s),this.fetchDataPages(l,i)}},methods:{isEmpty:e=>Array.isArray(e)&&0===e.length,closeDialog(){this.$emit("update:dialog",!1)},addDataMetric(){this.showArrChart=!1;const e=new FormData;e.append("title",this.titlePage),e.append("metrics",this.selectMetric),e.append("time",this.selectTime),e.append("color",this.selectedColor),fetch("../cms/add-arr-chart",{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.$nextTick((()=>{this.arrChart.push(e.data),console.log(this.arrChart),this.showArrChart=!0,this.closeDialog()}))})).catch((e=>{console.log(e)}))},shouldShow(e){switch(e){case"5":return this.showVisi;case"6":return this.showPages;case"7":return this.showSources;case"8":return this.showDevi;default:return!1}},addMetric(){this.dialogCreateMetric=!0},addProper(){this.dialogCreateProper=!0},replaceDash:e=>"string"==typeof e?e.replace("_"," "):e,changeData(e){this.showChart=!1;const t=this.timeSelect,a=new FormData;a.append("metrics",e),a.append("time",t),this.fetchData(a,e)},changeDevi(e){this.showChartDevi=!1;const t=this.selectTypeMetric,a=new FormData;a.append("property",e),a.append("metrics",t),this.fetchDataDevi(a,e)},changePages(e){this.showChartPages=!1;const t=new FormData;t.append("property",e),this.fetchDataPages(t,e)},fetchData(e,t){fetch("../cms/get-list-views-plausible",{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.$nextTick((()=>{this.chartVies=e.data,this.showChart=!0,this.keyActive=t}))})).catch((e=>{console.log(e)}))},fetchDataDevi(e,t){fetch("../cms/get-list-views-plausible-devi",{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.$nextTick((()=>{this.chartDevis=e.data,this.showChartDevi=!0,this.keyDeActive=t}))})).catch((e=>{console.log(e)}))},fetchDataPages(e,t){fetch("../cms/get-list-views-plausible-pages",{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.$nextTick((()=>{this.chartPages=e.data,this.showChartPages=!0,this.keyPageActive=t}))})).catch((e=>{console.log(e)}))},overview(){this.showVisi=!this.showVisi},pages(){this.showPages=!this.showPages},devices(){this.showDevi=!this.showDevi},sources(){this.showSources=!this.showSources}}},ce=Object.assign(oe,{layout:e},{__name:"Widget",props:{chartVisitors:[Object,Array],totalArr:[Object,Array],chartTopPages:[Object,Array],chartDevices:[Object,Array],chartSources:[Object,Array],plausibleSetting:Object,arrChart:[Object,Array]},setup:e=>(t,i)=>{const oe=l("v-icon"),ce=l("v-btn"),de=l("v-list-item-title"),ne=l("v-list-item"),he=l("v-list"),pe=l("v-card"),me=l("v-menu"),ue=l("v-dialog"),ge=l("v-col"),fe=l("v-container"),ye=l("v-text-field"),ve=l("LineChart"),we=l("BarChart"),Ce=l("draggable"),De=l("DateRange"),ke=l("Select"),xe=l("grid-item"),be=l("grid-layout");return r(),o("div",C,[c("div",D,[c("div",k,[c("div",x,[d(oe,{icon:"mdi-widgets",class:"--objectIcon me-3"}),b]),c("div",S,[d(me,{modelValue:t.menu,"onUpdate:modelValue":i[10]||(i[10]=e=>t.menu=e),"close-on-content-click":!1},{activator:n((({props:e})=>[d(ce,h({class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-plus"},e),{default:n((()=>[p(" Add Portlet ")])),_:2},1040)])),default:n((()=>[d(pe,{"min-width":"150"},{default:n((()=>[d(he,null,{default:n((()=>[d(ne,{onClick:i[1]||(i[1]=e=>t.overview())},{append:n((()=>[d(oe,{onClick:i[0]||(i[0]=e=>t.handleChangeField(t.field.key)),icon:t.showVisi?"mdi-eye":"mdi-eye-off"},null,8,["icon"])])),default:n((()=>[d(de,null,{default:n((()=>[p("Base")])),_:1})])),_:1}),d(ne,{onClick:i[3]||(i[3]=e=>t.pages())},{append:n((()=>[d(oe,{onClick:i[2]||(i[2]=e=>t.handleChangeField(t.field.key)),icon:t.showPages?"mdi-eye":"mdi-eye-off"},null,8,["icon"])])),default:n((()=>[d(de,null,{default:n((()=>[p("Top Pages")])),_:1})])),_:1}),d(ne,{onClick:i[5]||(i[5]=e=>t.sources())},{append:n((()=>[d(oe,{onClick:i[4]||(i[4]=e=>t.handleChangeField(t.field.key)),icon:t.showSources?"mdi-eye":"mdi-eye-off"},null,8,["icon"])])),default:n((()=>[d(de,null,{default:n((()=>[p("Top Sources")])),_:1})])),_:1}),d(ne,{onClick:i[7]||(i[7]=e=>t.devices())},{append:n((()=>[d(oe,{onClick:i[6]||(i[6]=e=>t.handleChangeField(t.field.key)),icon:t.showDevi?"mdi-eye":"mdi-eye-off"},null,8,["icon"])])),default:n((()=>[d(de,null,{default:n((()=>[p("Devices")])),_:1})])),_:1}),d(ne,{onClick:i[8]||(i[8]=e=>t.addMetric())},{append:n((()=>[d(oe,{icon:"mdi-plus"})])),default:n((()=>[d(de,null,{default:n((()=>[p("Add Metric")])),_:1})])),_:1}),d(ne,{onClick:i[9]||(i[9]=e=>t.addProper())},{append:n((()=>[d(oe,{icon:"mdi-plus"})])),default:n((()=>[d(de,null,{default:n((()=>[p("Add Property")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),d(ue,{width:"500",modelValue:t.dialogCreateMetric,"onUpdate:modelValue":i[14]||(i[14]=e=>t.dialogCreateMetric=e)},{default:n((()=>[d(a,{data:e.arrChart,"onUpdate:arrChart":i[11]||(i[11]=t=>e.arrChart=t),"onUpdate:showArrChart":i[12]||(i[12]=e=>t.showArrChart=e),"onUpdate:dialog":i[13]||(i[13]=e=>t.dialogCreateMetric=e)},null,8,["data"])])),_:1},8,["modelValue"]),d(ue,{width:"500",modelValue:t.dialogCreateProper,"onUpdate:modelValue":i[18]||(i[18]=e=>t.dialogCreateProper=e)},{default:n((()=>[d(s,{data:e.arrChart,"onUpdate:arrChart":i[15]||(i[15]=t=>e.arrChart=t),"onUpdate:showArrChart":i[16]||(i[16]=e=>t.showArrChart=e),"onUpdate:dialog":i[17]||(i[17]=e=>t.dialogCreateProper=e)},null,8,["data"])])),_:1},8,["modelValue"])])])]),c("div",P,[d(fe,null,{default:n((()=>[d(ge,{cols:"12"},{default:n((()=>[c("div",V,[t.url_logo?(r(),o("img",{key:0,src:t.url_logo,style:{width:"24px",height:"23px"},alt:"Logo"},null,8,A)):m("",!0),c("h3",null,u(e.plausibleSetting?e.plausibleSetting.siteId:""),1)])])),_:1})])),_:1}),e.arrChart&&t.showArrChart?(r(),g(fe,{key:0},{default:n((()=>[_,d(Ce,{modelValue:t.columns,"onUpdate:modelValue":i[19]||(i[19]=e=>t.columns=e),class:"row draggable-container"},{default:n((()=>[(r(!0),o(f,null,y(e.arrChart,(e=>(r(),g(ge,{cols:"6"},{default:n((()=>[d(pe,{class:"itemWidgetWrapper",style:{height:"530px",width:"100%"}},{default:n((()=>[c("div",T,[c("div",R,[c("h3",j,u(e[0].title),1),c("div",$,[d(ye,{ref_for:!0,ref:"fieldRef",variant:"outlined",density:"compact","bg-color":"white",name:t.Time,hint:t.hint,modelValue:e[0].time,"onUpdate:modelValue":t=>e[0].time=t,disabled:!0},null,8,["name","hint","modelValue","onUpdate:modelValue"])])]),"metric"==e[0].type?(r(),o("div",M,[d(ve,{class:"h-100",chartData:e[0].chart,chartOptions:t.chartOptions},null,8,["chartData","chartOptions"])])):m("",!0),"pro"==e[0].type?(r(),o("div",O,[d(we,{class:"h-100",chartData:e[0].chart},null,8,["chartData"])])):m("",!0)])])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["modelValue"])])),_:1})):m("",!0),t.isEmpty(e.plausibleSetting)?m("",!0):(r(),g(be,{key:1,layout:t.layout,"col-num":12,"row-height":30,"is-draggable":!0,"is-resizable":!0,"is-mirrored":!1,"vertical-compact":!0,margin:[10,10],"use-css-transforms":!0},{default:n((()=>[U,(r(!0),o(f,null,y(t.layout,(a=>(r(),g(xe,{x:a.x,y:a.y,w:a.w,h:a.h,i:a.i,key:a.i,style:v({visibility:t.shouldShow(a.i)?"visible":"hidden",padding:"12px"})},{default:n((()=>[5==a.i&&t.chartVies&&t.showVisi?(r(),g(pe,{key:0,class:"itemWidgetWrapper",style:{height:"100%",width:"100%"}},{default:n((()=>[c("div",W,[c("div",F,[E,c("div",I,[t.showCustomRange?(r(),g(De,{key:0,modelValue:t.dateRange,"onUpdate:modelValue":i[20]||(i[20]=e=>t.dateRange=e),label:"Custom Range"},null,8,["modelValue"])):m("",!0),d(ke,{label:"Time",items:t.arrTime,modelValue:t.timeSelect,"onUpdate:modelValue":i[21]||(i[21]=e=>t.timeSelect=e)},null,8,["items","modelValue"])])]),e.totalArr?(r(),o("div",L,[(r(!0),o(f,null,y(e.totalArr,((e,a)=>(r(),o("div",{class:"total-info",key:a},[c("p",{class:w({title:!0,active:a===t.keyActive}),onClick:e=>t.changeData(a)},u(t.replaceDash(a)),11,G),c("p",null,u(e.value),1)])))),128))])):m("",!0),t.showChart?(r(),o("div",q,[d(ve,{class:"h-100",chartData:t.chartVies,chartOptions:t.chartOptions},null,8,["chartData","chartOptions"])])):m("",!0)])])),_:1})):m("",!0),6==a.i&&t.chartPages&&t.showPages?(r(),g(pe,{key:1,class:"itemWidgetWrapper",style:{height:"100%"}},{default:n((()=>[c("div",B,[c("div",H,[N,c("div",z,[t.showCustomRange2?(r(),g(De,{key:0,modelValue:t.dateRange2,"onUpdate:modelValue":i[22]||(i[22]=e=>t.dateRange2=e),label:"Custom Range"},null,8,["modelValue"])):m("",!0),d(ke,{label:"Time",items:t.arrTime2,modelValue:t.timeSelect2,"onUpdate:modelValue":i[23]||(i[23]=e=>t.timeSelect2=e)},null,8,["items","modelValue"])])]),e.totalArr?(r(),o("div",K,[(r(!0),o(f,null,y(t.totalPages,((e,a)=>(r(),o("div",{class:"total-info-devi",key:a},[c("p",{class:w({title:!0,active:e.title===t.keyPageActive}),onClick:a=>t.changePages(e.title)},u(e.title),11,J)])))),128))])):m("",!0),t.showChartPages?(r(),o("div",Q,[d(we,{class:"h-100",chartData:t.chartPages},null,8,["chartData"])])):m("",!0)])])),_:1})):m("",!0),7==a.i&&e.chartSources&&t.showSources?(r(),g(pe,{key:2,class:"itemWidgetWrapper",style:{height:"100%"}},{default:n((()=>[c("div",X,[Y,c("div",Z,[d(we,{class:"h-100",chartData:e.chartSources},null,8,["chartData"])])])])),_:1})):m("",!0),8==a.i&&t.chartDevis&&t.showDevi?(r(),g(pe,{key:3,class:"itemWidgetWrapper",style:{height:"100%"}},{default:n((()=>[c("div",ee,[c("div",te,[ae,c("div",se,[t.showCustomRange4?(r(),g(De,{key:0,modelValue:t.dateRange4,"onUpdate:modelValue":i[24]||(i[24]=e=>t.dateRange4=e),label:"Custom Range"},null,8,["modelValue"])):m("",!0),d(ke,{label:"Time",items:t.arrTime4,modelValue:t.timeSelect4,"onUpdate:modelValue":i[25]||(i[25]=e=>t.timeSelect4=e)},null,8,["items","modelValue"]),d(ke,{items:t.typeMetric,label:"Metrics",modelValue:t.selectTypeMetric,"onUpdate:modelValue":i[26]||(i[26]=e=>t.selectTypeMetric=e)},null,8,["items","modelValue"])])]),e.totalArr?(r(),o("div",ie,[(r(!0),o(f,null,y(t.totalDevi,((e,a)=>(r(),o("div",{class:"total-info-devi",key:a},[c("p",{class:w({title:!0,active:e.title===t.keyDeActive}),onClick:a=>t.changeDevi(e.title)},u(e.title),11,le)])))),128))])):m("",!0),t.showChartDevi?(r(),o("div",re,[d(we,{class:"h-100",chartData:t.chartDevis},null,8,["chartData"])])):m("",!0)])])),_:1})):m("",!0)])),_:2},1032,["x","y","w","h","i","style"])))),128))])),_:1},8,["layout"]))])])}});export{ce as default};
