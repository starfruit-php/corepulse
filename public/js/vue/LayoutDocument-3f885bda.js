import e from"./Layout-9a29d640.js";import{r as t,o as n,h as i,f as o,a as l,w as d,z as a,d as r,c as s,i as c,t as p,u,T as h,k as m}from"./app-b548be80.js";import g from"./ModalCreatePage-16b14141.js";import f from"./ModalAddNew-5418448f.js";const y={class:"d-flex"},k={style:{width:"100%"}},v={class:"mainAppWrapper d-flex flex-column"},C={class:"mainBarWrapper px-5 py-3 d-flex justify-space-between align-center flex-grow-0 flex-shrink-0"},w={class:"--left d-flex align-center"},A=o("div",{class:"d-flex flex-column me-4"},[o("h3",{class:"--objectTitle me-4"},"Document")],-1),b={class:"mainContentWrapper px-5 py-4 d-flex flex-column flex-grow-1 flex-shrink-1 overflow-hidden"},T={class:"tableListingWrapper d-flex flex-column flex-shrink-1 flex-grow-1 overflow-hidden"},_={style:{display:"flex","align-items":"center"}},D={style:{display:"flex","align-items":"center",width:"100%","list-style-type":"none"}},x={style:{width:"100%"}},P={class:"node-wrapper",style:{display:"flex"}},I=o("div",{class:"icon-wrapper"},null,-1),L=o("div",{class:"input-wrapper"},null,-1),N={class:"info-item"},S=o("strong",null,"Name:",-1),O=o("p",{innerHTML:"|"},null,-1),j=o("strong",null,"Type:",-1),F=o("p",{innerHTML:"|"},null,-1),E=o("strong",null,"Status:",-1),M=o("p",{innerHTML:"|"},null,-1),H=o("strong",null,"ModificationDate:",-1),U={class:"btn-quickCreate"},V={class:"info-item"},$=o("strong",null,"Name:",-1),B=o("p",{innerHTML:"|"},null,-1),z=o("strong",null,"Type:",-1),W=o("p",{innerHTML:"|"},null,-1),J=o("strong",null,"Status:",-1),q=o("p",{innerHTML:"|"},null,-1),K=o("strong",null,"ModificationDate:",-1),R={class:"btn-quickCreate"},Y={data(){var e=window.location.href;let t=window.localStorage.getItem(e);const n=[{key:"id",title:"Id",removable:!0},{key:"parentId",title:"Parent Id",removable:!0},{key:"key",title:"Key",removable:!0},{key:"type",title:"Type",removable:!0},{key:"published",title:"Published",removable:!0},{key:"className",title:"Class Name",removable:!0},{key:"path",title:"Full Path",removable:!0}];t?(t=JSON.parse(t),n.length!=t.length&&(t=n,window.localStorage.setItem(e,JSON.stringify(t)))):(t=n,window.localStorage.setItem(e,JSON.stringify(t)));var i=[];return t.map((e=>{e.removable&&i.push(e)})),{nodes:{},config:{},objectSelect:[],isLoading:!1,dataListing:[],routerList:{router:route("tree_table_doc")},headers:i,fields:t,limit:25,isTable:!1,nodeChecked:[],totalItems:0,open:["DocumentTree"],isMenuVisible:!1,dialogCreatePage:!1,folderId:"",notTypes:["snippet","printcontainer","newsletter","email"],home:{},menu:!1,toast:m.useToast({position:"top-right"})}},watch:{nodeChecked:{handler:function(e,t){},deep:!0}},mounted(){this.$nextTick((()=>{this.getTree()}))},methods:{nodeOpenedAction(e){this.$nextTick((()=>{e.children=[],this.isLoading=!0,this.updateChildren(e)}))},nodeClosedAction(e){},nodeToggleAction(e){},nodeBlurAction(e){},nodeEditAction(e){},nodeCheckedAction(e){this.nodeChecked.push(e)},nodeUncheckedAction(e){this.nodeChecked=this.nodeChecked.filter((t=>t.id!==e.id))},nodeDragstartAction(e){},nodeDragenterAction(e){},nodeDragleaveAction(e){},nodeDragendAction(e){},nodeOverAction(e){},nodeDropAction(e){this.$nextTick((()=>{const{dragged:t,target:n,evt:i}=e,o=e.dragged.node.id,l=e.target.node,d=i.clientY,a=n.element.getBoundingClientRect();var r="";r=d<a.top+a.height/3?-1:d>a.top+2*a.height/3?1:2,this.updateParent("Document",o,l,r)}))},nodeFocusAction(e){},updateParent(e,t,n,i){let o=new FormData;t||(t=1),n||(n=1),o.append("root",e),o.append("idDrap",t),o.append("idDrop",n),o.append("index",i),fetch(route("tree_update_doc"),{method:"POST",body:o}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.isLoading=!1,e.status||this.getTree()})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},updateChildren(e){const t=e.id,n=this.objectSelect;let i=new FormData;i.append("id",t),n.forEach(((e,t)=>{i.append("config[]",e)})),fetch(route("tree_children_doc"),{method:"POST",body:i}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.nodes={...this.nodes,...e.nodes},e.children||(this.nodes[t].state.indeterminate=!0),this.nodes[t].children=e.children,this.isLoading=!1})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},getTree(){this.isLoading=!0;let e=new FormData;fetch(route("tree_listing_doc"),{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.$nextTick((()=>{this.nodes=e.nodes,this.config=e.config,this.home=e.home}))})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},clearNodeChecked(e){this.nodes[e.id].state.checked=!1,this.nodeChecked=this.nodeChecked.filter((t=>t.id!==e.id))},detailItem(e){this.$inertia.post("/cms/document/detail/"+e)},deleteItem(e){const t=new FormData;t.append("id",e),t.append("page","catalog"),this.$inertia.post("/cms/document/delete",t),setTimeout((()=>{this.toast.open({message:"Upload successfully",type:"success"}),this.getTree()}),2e3)},createPage(e){this.dialogCreatePage=!0,this.typeCreate="Page",this.menu=!1,this.folderId=e},createSnippet(e){this.dialogCreatePage=!0,this.typeCreate="Snippet",this.menu=!1,this.folderId=e},createLink(e){this.dialogCreatePage=!0,this.typeCreate="Link",this.menu=!1,this.folderId=e},createEmail(e){this.dialogCreatePage=!0,this.typeCreate="Email",this.menu=!1,this.folderId=e},createHardlink(e){this.dialogCreatePage=!0,this.typeCreate="Hardlink",this.menu=!1,this.folderId=e},createFolder(e){this.dialogCreatePage=!0,this.typeCreate="Folder",this.menu=!1,this.folderId=e}}},G=Object.assign(Y,{layout:e},{__name:"LayoutDocument",setup:e=>(e,m)=>{const Y=t("v-icon"),G=t("v-btn"),Q=t("v-list-item-title"),X=t("v-list-item"),Z=t("v-list"),ee=t("v-card"),te=t("v-menu"),ne=t("v-progress-linear"),ie=t("v-tooltip"),oe=t("v-dialog");return n(),i("div",y,[o("div",k,[o("div",v,[o("div",C,[o("div",w,[l(Y,{icon:"mdi-file-document",class:"--objectIcon me-3"}),A,l(te,{modelValue:e.menu,"onUpdate:modelValue":m[6]||(m[6]=t=>e.menu=t),"close-on-content-click":!1},{activator:d((({props:t})=>[l(G,a({class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-plus"},t),{default:d((()=>[r(" Add New ")])),_:2},1040),l(G,a({class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-folder-plus"},t,{onClick:m[0]||(m[0]=t=>e.createFolder())}),{default:d((()=>[r(" Add Folder ")])),_:2},1040)])),default:d((()=>[l(ee,{"min-width":"150"},{default:d((()=>[l(Z,null,{default:d((()=>[l(X,{onClick:m[1]||(m[1]=t=>e.createPage(1))},{prepend:d((()=>[l(Y,{icon:"mdi-file-document-plus-outline"})])),default:d((()=>[l(Q,null,{default:d((()=>[r("Add Page")])),_:1})])),_:1}),l(X,{onClick:m[2]||(m[2]=t=>e.createSnippet(1))},{prepend:d((()=>[l(Y,{icon:"mdi-file-code-outline"})])),default:d((()=>[l(Q,null,{default:d((()=>[r("Add Snippet")])),_:1})])),_:1}),l(X,{onClick:m[3]||(m[3]=t=>e.createLink(1))},{prepend:d((()=>[l(Y,{icon:"mdi-link"})])),default:d((()=>[l(Q,null,{default:d((()=>[r("Add Link")])),_:1})])),_:1}),l(X,{onClick:m[4]||(m[4]=t=>e.createEmail(1))},{prepend:d((()=>[l(Y,{icon:"mdi-email-outline"})])),default:d((()=>[l(Q,null,{default:d((()=>[r("Add Email")])),_:1})])),_:1}),l(X,{onClick:m[5]||(m[5]=t=>e.createHardlink(1))},{prepend:d((()=>[l(Y,{icon:"mdi-link-variant"})])),default:d((()=>[l(Q,null,{default:d((()=>[r("Add Hardlink")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])]),o("div",b,[o("div",T,[e.isLoading?(n(),s(ne,{key:0,active:e.isLoading,indeterminate:""},null,8,["active"])):c("",!0),o("div",_,[o("ul",D,[o("li",x,[o("div",P,[I,l(Y,null,{default:d((()=>[r(p(e.home.icon),1)])),_:1}),L,o("div",N,[o("p",null,[S,r(" "+p(e.home.key),1)]),r(),O,o("p",null,[j,r(" "+p(e.home.type),1)]),r(),F,o("p",null,[E,r(" "+p(e.home.publish?"Publish":"Unpublish"),1)]),r(),M,o("p",null,[H,r(" "+p(e.home.modificationDate),1)])]),l(ie,{activator:"parent",location:"end"},{default:d((()=>[o("strong",null,"ID: "+p(e.home.id),1),r(" | Type: "+p(e.home.type),1)])),_:1}),o("div",U,[l(G,{icon:"mdi-eye-outline",size:"small",onClick:m[7]||(m[7]=t=>e.detailItem(e.home.id))}),l(f,{type:e.home.type,id:e.home.id},null,8,["type","id"])])])])])]),(n(),s(u(h),{key:e.nodes,config:e.config,nodes:e.nodes,onNodeOpened:m[8]||(m[8]=t=>e.nodeOpenedAction(t)),onNodeClosed:m[9]||(m[9]=t=>e.nodeClosedAction(t)),onNodeFocus:m[10]||(m[10]=t=>e.nodeFocusAction(t)),onNodeToggle:m[11]||(m[11]=t=>e.nodeToggleAction(t)),onNodeBlur:m[12]||(m[12]=t=>e.nodeBlurAction(t)),onNodeEdit:m[13]||(m[13]=t=>e.nodeEditAction(t)),onNodeChecked:m[14]||(m[14]=t=>e.nodeCheckedAction(t)),onNodeUnchecked:m[15]||(m[15]=t=>e.nodeUncheckedAction(t)),onNodeDragstart:m[16]||(m[16]=t=>e.nodeDragstartAction(t)),onNodeDragenter:m[17]||(m[17]=t=>e.nodeDragenterAction(t)),onNodeDragleave:m[18]||(m[18]=t=>e.nodeDragleaveAction(t)),onNodeDragend:m[19]||(m[19]=t=>e.nodeDragendAction(t)),onNodeOver:m[20]||(m[20]=t=>e.nodeOverAction(t)),onNodeDrop:m[21]||(m[21]=t=>e.nodeDropAction(t))},{"before-input":d((e=>[l(Y,null,{default:d((()=>[r(p(e.node.icon),1)])),_:2},1024)])),"after-input":d((t=>[o("div",V,[o("p",null,[$,r(" "+p(t.node.key),1)]),r(),B,o("p",null,[z,r(" "+p(t.node.type),1)]),r(),W,o("p",null,[J,r(" "+p(t.node.publish?"Publish":"Unpublish"),1)]),r(),q,o("p",null,[K,r(" "+p(t.node.modificationDate),1)])]),l(ie,{activator:"parent",location:"end"},{default:d((()=>[o("strong",null,"ID: "+p(t.node.id),1),r(" | Type: "+p(t.node.type),1)])),_:2},1024),o("div",R,[l(G,{icon:"mdi-eye-outline",size:"small",onClick:n=>e.detailItem(t.node.id)},null,8,["onClick"]),l(G,{icon:"mdi-delete-outline",size:"small",onClick:n=>e.deleteItem(t.node.id)},null,8,["onClick"]),l(f,{type:t.node.type,id:t.node.id},null,8,["type","id"])])])),_:1},8,["config","nodes"]))])])]),l(oe,{width:"500",modelValue:e.dialogCreatePage,"onUpdate:modelValue":m[23]||(m[23]=t=>e.dialogCreatePage=t)},{default:d((()=>[l(ee,null,{default:d((()=>[l(g,{"onUpdate:dialog":m[22]||(m[22]=t=>e.dialogCreatePage=t),type:e.typeCreate,folderId:e.folderId,catalog:"catalog"},null,8,["type","folderId"])])),_:1})])),_:1},8,["modelValue"])])])}});export{G as default};
