import e from"./Layout-808b9c88.js";import{T as t}from"./vue3-treeview-e35ab4eb.js";import n from"./ModalCreatePage-dadbbb60.js";import i from"./ModalAddNew-3e5ddad1.js";import{d as o}from"./vue-toast-notification-f2a3de7a.js";import{am as l,o as d,c as a,a as r,k as s,q as c,A as p,N as u,C as h,E as m,M as g,z as f}from"./@vue-9ee83fb6.js";import"./@vueuse-3c3b27e0.js";import"./unidecode-5a54da0f.js";import"./@ckeditor-fa9b3055.js";import"./vue-abe8eda6.js";const y={class:"d-flex"},k={style:{width:"100%"}},v={class:"mainAppWrapper d-flex flex-column"},C={class:"mainBarWrapper px-5 py-3 d-flex justify-space-between align-center flex-grow-0 flex-shrink-0"},A={class:"--left d-flex align-center"},w=r("div",{class:"d-flex flex-column me-4"},[r("h3",{class:"--objectTitle me-4"},"Document")],-1),b={class:"mainContentWrapper px-5 py-4 d-flex flex-column flex-grow-1 flex-shrink-1 overflow-hidden"},T={class:"tableListingWrapper d-flex flex-column flex-shrink-1 flex-grow-1 overflow-hidden"},_={style:{display:"flex","align-items":"center"}},D={style:{display:"flex","align-items":"center",width:"100%","list-style-type":"none"}},x={style:{width:"100%"}},P={class:"node-wrapper",style:{display:"flex"}},I=r("div",{class:"icon-wrapper"},null,-1),L=r("div",{class:"input-wrapper"},null,-1),N={class:"info-item"},S=r("strong",null,"Name:",-1),j=r("p",{innerHTML:"|"},null,-1),O=r("strong",null,"Type:",-1),M=r("p",{innerHTML:"|"},null,-1),E=r("strong",null,"Status:",-1),F=r("p",{innerHTML:"|"},null,-1),H=r("strong",null,"ModificationDate:",-1),U={class:"btn-quickCreate"},V={class:"info-item"},$=r("strong",null,"Name:",-1),B=r("p",{innerHTML:"|"},null,-1),z=r("strong",null,"Type:",-1),W=r("p",{innerHTML:"|"},null,-1),q=r("strong",null,"Status:",-1),J=r("p",{innerHTML:"|"},null,-1),K=r("strong",null,"ModificationDate:",-1),R={class:"btn-quickCreate"},Y={data(){var e=window.location.href;let t=window.localStorage.getItem(e);const n=[{key:"id",title:"Id",removable:!0},{key:"parentId",title:"Parent Id",removable:!0},{key:"key",title:"Key",removable:!0},{key:"type",title:"Type",removable:!0},{key:"published",title:"Published",removable:!0},{key:"className",title:"Class Name",removable:!0},{key:"path",title:"Full Path",removable:!0}];t?(t=JSON.parse(t),n.length!=t.length&&(t=n,window.localStorage.setItem(e,JSON.stringify(t)))):(t=n,window.localStorage.setItem(e,JSON.stringify(t)));var i=[];return t.map((e=>{e.removable&&i.push(e)})),{nodes:{},config:{},objectSelect:[],isLoading:!1,dataListing:[],routerList:{router:route("tree_table_doc")},headers:i,fields:t,limit:25,isTable:!1,nodeChecked:[],totalItems:0,open:["DocumentTree"],isMenuVisible:!1,dialogCreatePage:!1,folderId:"",notTypes:["snippet","printcontainer","newsletter","email"],home:{},menu:!1,toast:o.useToast({position:"top-right"})}},watch:{nodeChecked:{handler:function(e,t){},deep:!0}},mounted(){this.$nextTick((()=>{this.getTree()}))},methods:{nodeOpenedAction(e){this.$nextTick((()=>{e.children=[],this.isLoading=!0,this.updateChildren(e)}))},nodeClosedAction(e){},nodeToggleAction(e){},nodeBlurAction(e){},nodeEditAction(e){},nodeCheckedAction(e){this.nodeChecked.push(e)},nodeUncheckedAction(e){this.nodeChecked=this.nodeChecked.filter((t=>t.id!==e.id))},nodeDragstartAction(e){},nodeDragenterAction(e){},nodeDragleaveAction(e){},nodeDragendAction(e){},nodeOverAction(e){},nodeDropAction(e){this.$nextTick((()=>{const{dragged:t,target:n,evt:i}=e,o=e.dragged.node.id,l=e.target.node,d=i.clientY,a=n.element.getBoundingClientRect();var r="";r=d<a.top+a.height/3?-1:d>a.top+2*a.height/3?1:2,this.updateParent("Document",o,l,r)}))},nodeFocusAction(e){},updateParent(e,t,n,i){let o=new FormData;t||(t=1),n||(n=1),o.append("root",e),o.append("idDrap",t),o.append("idDrop",n),o.append("index",i),fetch(route("tree_update_doc"),{method:"POST",body:o}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.isLoading=!1,e.status||this.getTree()})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},updateChildren(e){const t=e.id,n=this.objectSelect;let i=new FormData;i.append("id",t),n.forEach(((e,t)=>{i.append("config[]",e)})),fetch(route("tree_children_doc"),{method:"POST",body:i}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.nodes={...this.nodes,...e.nodes},e.children||(this.nodes[t].state.indeterminate=!0),this.nodes[t].children=e.children,this.isLoading=!1})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},getTree(){this.isLoading=!0;let e=new FormData;fetch(route("tree_listing_doc"),{method:"POST",body:e}).then((e=>{if(e.ok)return e.json();throw new Error("Có lỗi khi gửi yêu cầu POST.")})).then((e=>{this.$nextTick((()=>{this.nodes=e.nodes,this.config=e.config,this.home=e.home}))})).catch((e=>{console.error(e)})).finally((()=>{this.isLoading=!1}))},clearNodeChecked(e){this.nodes[e.id].state.checked=!1,this.nodeChecked=this.nodeChecked.filter((t=>t.id!==e.id))},detailItem(e){this.$inertia.post("/cms/document/detail/"+e)},deleteItem(e){const t=new FormData;t.append("id",e),t.append("page","catalog"),this.$inertia.post("/cms/document/delete",t),setTimeout((()=>{this.toast.open({message:"Upload successfully",type:"success"}),this.getTree()}),2e3)},createPage(e){this.dialogCreatePage=!0,this.typeCreate="Page",this.menu=!1,this.folderId=e},createSnippet(e){this.dialogCreatePage=!0,this.typeCreate="Snippet",this.menu=!1,this.folderId=e},createLink(e){this.dialogCreatePage=!0,this.typeCreate="Link",this.menu=!1,this.folderId=e},createEmail(e){this.dialogCreatePage=!0,this.typeCreate="Email",this.menu=!1,this.folderId=e},createHardlink(e){this.dialogCreatePage=!0,this.typeCreate="Hardlink",this.menu=!1,this.folderId=e},createFolder(e){this.dialogCreatePage=!0,this.typeCreate="Folder",this.menu=!1,this.folderId=e}}},G=Object.assign(Y,{layout:e},{__name:"LayoutDocument",setup:e=>(e,o)=>{const Y=l("v-icon"),G=l("v-btn"),Q=l("v-list-item-title"),X=l("v-list-item"),Z=l("v-list"),ee=l("v-card"),te=l("v-menu"),ne=l("v-progress-linear"),ie=l("v-tooltip"),oe=l("v-dialog");return d(),a("div",y,[r("div",k,[r("div",v,[r("div",C,[r("div",A,[s(Y,{icon:"mdi-file-document",class:"--objectIcon me-3"}),w,s(te,{modelValue:e.menu,"onUpdate:modelValue":o[6]||(o[6]=t=>e.menu=t),"close-on-content-click":!1},{activator:c((({props:t})=>[s(G,p({class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-plus"},t),{default:c((()=>[u(" Add New ")])),_:2},1040),s(G,p({class:"btn-primary me-2",variant:"elevated","prepend-icon":"mdi-folder-plus"},t,{onClick:o[0]||(o[0]=t=>e.createFolder())}),{default:c((()=>[u(" Add Folder ")])),_:2},1040)])),default:c((()=>[s(ee,{"min-width":"150"},{default:c((()=>[s(Z,null,{default:c((()=>[s(X,{onClick:o[1]||(o[1]=t=>e.createPage(1))},{prepend:c((()=>[s(Y,{icon:"mdi-file-document-plus-outline"})])),default:c((()=>[s(Q,null,{default:c((()=>[u("Add Page")])),_:1})])),_:1}),s(X,{onClick:o[2]||(o[2]=t=>e.createSnippet(1))},{prepend:c((()=>[s(Y,{icon:"mdi-file-code-outline"})])),default:c((()=>[s(Q,null,{default:c((()=>[u("Add Snippet")])),_:1})])),_:1}),s(X,{onClick:o[3]||(o[3]=t=>e.createLink(1))},{prepend:c((()=>[s(Y,{icon:"mdi-link"})])),default:c((()=>[s(Q,null,{default:c((()=>[u("Add Link")])),_:1})])),_:1}),s(X,{onClick:o[4]||(o[4]=t=>e.createEmail(1))},{prepend:c((()=>[s(Y,{icon:"mdi-email-outline"})])),default:c((()=>[s(Q,null,{default:c((()=>[u("Add Email")])),_:1})])),_:1}),s(X,{onClick:o[5]||(o[5]=t=>e.createHardlink(1))},{prepend:c((()=>[s(Y,{icon:"mdi-link-variant"})])),default:c((()=>[s(Q,null,{default:c((()=>[u("Add Hardlink")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])]),r("div",b,[r("div",T,[e.isLoading?(d(),h(ne,{key:0,active:e.isLoading,indeterminate:""},null,8,["active"])):m("",!0),r("div",_,[r("ul",D,[r("li",x,[r("div",P,[I,s(Y,null,{default:c((()=>[u(g(e.home.icon),1)])),_:1}),L,r("div",N,[r("p",null,[S,u(" "+g(e.home.key),1)]),u(),j,r("p",null,[O,u(" "+g(e.home.type),1)]),u(),M,r("p",null,[E,u(" "+g(e.home.publish?"Publish":"Unpublish"),1)]),u(),F,r("p",null,[H,u(" "+g(e.home.modificationDate),1)])]),s(ie,{activator:"parent",location:"end"},{default:c((()=>[r("strong",null,"ID: "+g(e.home.id),1),u(" | Type: "+g(e.home.type),1)])),_:1}),r("div",U,[s(G,{icon:"mdi-eye-outline",size:"small",onClick:o[7]||(o[7]=t=>e.detailItem(e.home.id))}),s(i,{type:e.home.type,id:e.home.id},null,8,["type","id"])])])])])]),(d(),h(f(t),{key:e.nodes,config:e.config,nodes:e.nodes,onNodeOpened:o[8]||(o[8]=t=>e.nodeOpenedAction(t)),onNodeClosed:o[9]||(o[9]=t=>e.nodeClosedAction(t)),onNodeFocus:o[10]||(o[10]=t=>e.nodeFocusAction(t)),onNodeToggle:o[11]||(o[11]=t=>e.nodeToggleAction(t)),onNodeBlur:o[12]||(o[12]=t=>e.nodeBlurAction(t)),onNodeEdit:o[13]||(o[13]=t=>e.nodeEditAction(t)),onNodeChecked:o[14]||(o[14]=t=>e.nodeCheckedAction(t)),onNodeUnchecked:o[15]||(o[15]=t=>e.nodeUncheckedAction(t)),onNodeDragstart:o[16]||(o[16]=t=>e.nodeDragstartAction(t)),onNodeDragenter:o[17]||(o[17]=t=>e.nodeDragenterAction(t)),onNodeDragleave:o[18]||(o[18]=t=>e.nodeDragleaveAction(t)),onNodeDragend:o[19]||(o[19]=t=>e.nodeDragendAction(t)),onNodeOver:o[20]||(o[20]=t=>e.nodeOverAction(t)),onNodeDrop:o[21]||(o[21]=t=>e.nodeDropAction(t))},{"before-input":c((e=>[s(Y,null,{default:c((()=>[u(g(e.node.icon),1)])),_:2},1024)])),"after-input":c((t=>[r("div",V,[r("p",null,[$,u(" "+g(t.node.key),1)]),u(),B,r("p",null,[z,u(" "+g(t.node.type),1)]),u(),W,r("p",null,[q,u(" "+g(t.node.publish?"Publish":"Unpublish"),1)]),u(),J,r("p",null,[K,u(" "+g(t.node.modificationDate),1)])]),s(ie,{activator:"parent",location:"end"},{default:c((()=>[r("strong",null,"ID: "+g(t.node.id),1),u(" | Type: "+g(t.node.type),1)])),_:2},1024),r("div",R,[s(G,{icon:"mdi-eye-outline",size:"small",onClick:n=>e.detailItem(t.node.id)},null,8,["onClick"]),s(G,{icon:"mdi-delete-outline",size:"small",onClick:n=>e.deleteItem(t.node.id)},null,8,["onClick"]),s(i,{type:t.node.type,id:t.node.id},null,8,["type","id"])])])),_:1},8,["config","nodes"]))])])]),s(oe,{width:"500",modelValue:e.dialogCreatePage,"onUpdate:modelValue":o[23]||(o[23]=t=>e.dialogCreatePage=t)},{default:c((()=>[s(ee,null,{default:c((()=>[s(n,{"onUpdate:dialog":o[22]||(o[22]=t=>e.dialogCreatePage=t),type:e.typeCreate,folderId:e.folderId,catalog:"catalog"},null,8,["type","folderId"])])),_:1})])),_:1},8,["modelValue"])])])}});export{G as default};
